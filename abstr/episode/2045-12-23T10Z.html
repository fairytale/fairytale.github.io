<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Alice M. Lorenz" />
  <title>η Expansion</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../../pandoc/org.css" type="text/css" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<link rel="icon" href="../img/abstr.ico" type="image/vnd.microsoft.icon" />
</head>
<body>
<div id="header">
<h1 class="title">η Expansion</h1>
<h2 class="author">Alice M. Lorenz</h2>
<h3 class="date">2046-01-07T11Z</h3>
</div>
<p align="center" class="file-vars">
(* -*- title: &quot;λ Abstraction&quot;; episode: &quot;η Expansion&quot; -*- *)
</p>
<p align="center">
<a href="../"><img id="logo" src="../img/abstr-logo.png" 
/></a>
</p>
<p align="center" class="warning">
<strong>これは執筆中のページです。</strong>
公開はされているものの、未完成です。
</p>
<p class="local-vars">
(* Local Variables: *)<br />
(* Continued-from: nil *)<br />
(* Continued-on: nil *)<br />
(* Version: &quot;0.0.6a&quot; *)<br />
(* Stability: writing *)<br />
(* Category: Novel *)<br /> 
(* End: *)<br />
</p>
<h1>Abstract</h1>
<p>　冬休みの3日めの夜。しんしんと降り続ける粉雪で、 道路が粉砂糖をかけたココアケーキみたい。 イルミネーションで豪勢に飾られたクリスマスツリーのために 道路は昼間のように明るい。</p>
<p>　仕事で疲れた社会人や 勉強をこなした学生が、みんな、帰りの電車に乗るために 京都駅へ吸い込まれるような流れをつくっている。</p>
<p>　そんななか、わたしは、京都駅から離れるように、 人の流れに逆らうようにして歩いている。</p>
<p>　目的地は京都λ抽象学院だ。</p>
<p>　なぜ、ほかのだれかではなく、よりにもよってこのわたしが 冬休みの3日めに学校へ出向くのかというと、 学校のわたしの住んでいる寮に設置されたサーバに、 昨日の昼頃、何者かが不正にログインし、Facebook Searchという 検索エンジンのTCPパケットを改竄してsearch.facebook.comドメイン以下の すべてのページにマルウェアへのリンクを張ったからだ。</p>
<p>　でも、たしかsearch.facebook.comはGGH暗号で暗号化されていたはず。</p>
<p>　GGH暗号というのは、格子暗号のひとつ。 格子暗号というのは、古典的な公開鍵暗号や楕円曲線暗号よりも安全な、 耐量子計算機暗号のひとつで、耐量子計算機暗号のうちでは もっとも主流のもの。</p>
<p>　耐量子計算機暗号を解読しなければ、TCPパケットの改竄はできない。</p>
<p>　search.facebook.comのTCPパケットを改竄するなんてこと、可能なのだろうか。</p>
<p>　ともあれ、京都λ抽象学院のルータを通して通信していたたくさんの 〈マシン〉がそのマルウェアに感染したことは事実としてあるらしく、 今日の午後それが発覚して、まず最初に疑われたのが、その 寮に住んでいる、わたしと、ソフィーヤと、真鳥の3人だったわけだ。</p>
<p>　耐量子計算機暗号で暗号化されたsearch.facebook.comが改竄された ということは、犯人は耐量子計算機暗号を解読してしまうほどの 技術力を持った人物ということになる。</p>
<p>　わたしと、ソフィーヤと、真鳥のうちで、そんなことが できる技術力を持っているとすればソフィーヤだけだ——彼女は 天才だ——けど、ソフィーヤはわたしの親友だし、 そんな悪いことをするはずがない。</p>
<p>　それに、動機だってないだろうし。</p>
<p>　それでも、わたしたちは疑われている。 身の潔白を主張するため、わたしは、いま京都λ抽象学院へ向かっている。</p>
<h1>Introduction</h1>
<p>　2045年12月23日土曜日午後7時前。 わたしは京都駅からバス停へ向かっている。</p>
<p>　バス停でソフィーヤが待っていた。彼女はロシア人だから 寒さには強いと思ってたけど普通に厚着をしていた。</p>
<p>　わたしはカーディガンのポケットに両手を突っ込み、震えながら 彼女を見上げてたずねる。</p>
<p>「ロシア人はこの時期でも薄着かと思ってたけど」</p>
<p>　ソフィーヤは表情を変えず冷静に答える。</p>
<p>「アリス、ロシアはシベリアじゃない……モスクワの気温は……たぶん ザールラントと変わらない」</p>
<p>　アリスことわたしはドイツのザールラント出身。 ソフィーヤはロシアのモスクワ出身。ふたりとも留学生。</p>
<p>　わたしとソフィーヤは京都府に住んでいるから待ち合わせられたけど、 真鳥は兵庫県に住んでいるから時間がかかる。</p>
<p>　それにしても、こんな時間に兵庫県から呼び寄せるなんて、 後藤先生も鬼畜だと思う。</p>
<p>　わたしはぼそっとつぶやく。</p>
<p>「真鳥はたいへんねぇ……ひょっとして今日は帰れないんじゃないかしら」</p>
<p>　ちらっとソフィーヤの顔を見ると、彼女の〈眼鏡〉には メールが表示されていた。彼女はメールを読みながら冷徹にも答える。</p>
<p>「寮があるから平気だと思う」</p>
<p>　バスが来たので、わたしとソフィーヤはバスに乗る。</p>
<p>　ソフィーヤは無言でなにかメールをしているみたい。</p>
<p>　わたしは唇を尖らせてそっぽを向いてたずねる。</p>
<p>「なに読んでるの」</p>
<p>　一緒にいるときにメールを読まれてると、 なんだか無視されてるみたいで。</p>
<p>　ソフィーヤは答える。</p>
<p>「後藤先生に質問してる……というのも……どこまで わかってるのか……掴んでおきたいから」</p>
<p>「サーバに侵入した犯人のこと？」</p>
<p>「そう……」</p>
<p>「ふん。悪いのは学院よ。セキュリティを怠ったのが悪いのよ」</p>
<p>「学院のセキュリティは……かなりしっかりしてると思うけど……」</p>
<p>「思う？　現在形？　わたしたち、意見が合うのね、わたしも 思っていたわよ——過去形であることに注意ね！——侵入された事実はないわ、 フィクションよ！　そうに違いないわ」</p>
<p>「……そうじゃないと思う……問題があったのは学院じゃなくて……むしろ生徒……」</p>
<p>「あらそう。なにか心当たりでも？」</p>
<p>　ソフィーヤは黙って目をうろうろさせ、うつむいてしまう。</p>
<p>　わたしはびっくりして思わずたずねる。</p>
<p>「……ほんとにあるの？」</p>
<p>「わたし……一昨日……サーバにログインしてた……リモートで……SSHで……」</p>
<p>　わたしは耳を疑う。ソフィーヤが？　サーバに？　ログイン？　リモート で？　SSHで？</p>
<p>　……量子コンピュータは市販されている。だから、SSHの 基盤になっているRSA暗号はすぐに解読されてしまう。まだGGH暗号に対応 していないSSHはほとんど信用ならない、 ログインするならLANでのみ、そう授業で習ったはず。</p>
<p>　SSHでリモート・ログインすると、TCPセッション・ハイジャックされる 可能性がある。だから、SSHでリモート・ログインすることは 危険なので校則で禁止されてる。</p>
<p>　でも、リモート・ログインは便利だから、ついつい使ってしまう。 盗聴される危険性があるのもわかるけど、 きっと、わたしだけは大丈夫だろう、そんな気持ちでみんな 使ってしまうんだ。</p>
<p>　わたしは確認する。</p>
<p>「ほんとなの……？」</p>
<p>　ソフィーヤはうなずく。</p>
<p>　鳥肌が立つ。緊張する。</p>
<p>　つまり、その、本当に原因はソフィーヤで、 秘密鍵が解読されて、パスワードが盗まれたってこと？</p>
<p>　もちろん犯人は別にいるとはいえ、そんな事実が発覚したら、 ソフィーヤはどうなるか。退学？　よくて停学？　サーバは 処分されるかも。同じ寮のわたしたちは？　どうなるかわからない。</p>
<p>　これから先の学校生活が破壊される。</p>
<p>　こわい。</p>
<p>　わたしは指をこねくり合わせて目を逸らし、たずねる。</p>
<p>「どっ、どうしてサーバにリモート・ログインしたのかしら」</p>
<p>「それはその……とあるファイルをサーバから〈マシン〉に コピーし忘れてたから……」</p>
<p>　とあるファイルがなんであるかは、たずねないほうがいいだろう。</p>
<p>　わたしはしどろもどろで言う。</p>
<p>「そう、残念、だわ……」</p>
<p>　バスが荒神口通りに着く。</p>
<p>　わたしとソフィーヤはそこで降りて、学校まで歩く。</p>
<p>　夜中の学校の、職員室の窓だけが光っている。</p>
<p>　わたしは門でインターホンを押す。</p>
<p>　インターホンのディスプレイに後藤先生の顔が写り、 彼女はおごそかに言う。</p>
<p>「いま、鍵を開けました。どうぞ入ってください」</p>
<p>　わたしとソフィーヤは学校のなかに入り、 職員室へ向かう。</p>
<p>　職員室の扉を開けると、温暖な空気が漏れ出てきて、 なかに入ると、眼鏡があっという間に曇る。</p>
<p>　わたしとソフィーヤは眼鏡を一度外し、結露を拭いてから 再度身に付ける。</p>
<p>　わたしたちは、目が悪いから眼鏡をしているわけではなくて、 この眼鏡はポケットにいれた〈マシン〉のディスプレイになっているのだ。</p>
<p>　また、表示できる情報は〈マシン〉のものだけではなく、 情報にアクセスさえできれば、パソコンのディスプレイのように なんでも表示できる。</p>
<p>　ただ、冬は暖かい部屋に入るとすぐ曇ってしまうのが難点だ。</p>
<p>　ところで、〈マシン〉というのは、いまの時代ならだいたい ひとりひとつは持っている、ポケットに入るくらいの小型デバイスのことだ。</p>
<p>　〈マシン〉にも種類はあるけど、たいていのスペックは128ビットCPUか 256ビットCPUで、メインメモリは512GB程度。マシンにはそれぞれ IPv6 によってグローバルIPアドレスが振られている。 OSはLinuxディストリビューションのいずれかであることが多い。 最近は16キュービットCPUや32キュービットCPUを積んだ〈量子マシン〉も あるらしいけど、わたしは持っていない。</p>
<p>　〈指輪〉で入力し、〈マシン〉が計算し、〈眼鏡〉が表示し、 〈イヤホン〉が鳴らし、〈嗅覚シール〉がにおわせてくれて、 〈味覚入れ歯〉があじあわせてくれる。</p>
<p>　これは、いまさら説明するまでもないような、当たり前のことだけど。</p>
<p>　ところで、職員室には後藤先生——わたしたちの担任——以外の先生はいない。</p>
<p>　わたしたちは後藤先生の机まで行く。</p>
<p>　後藤先生はしかめっ面で椅子に座っている。</p>
<p>　後藤先生がふだん通りの優しい口調で言う。</p>
<p>「どうぞ、空いている席はたくさんあります。お座りください」</p>
<p>　ソフィーヤは黙って言うとおりに座る。</p>
<p>　わたしはある椅子に座る前に高さを調節してから——つまり、 悔しいけど座席部分を可能な限り高くしてから——その椅子に座る。 それでもやや低過ぎる気がして悔しい。</p>
<p>　ソフィーヤがわたしを気遣ってくれたのか、何気なく言う。</p>
<p>「なんなら……わたしの膝の上に座っても……」</p>
<p>　わたしは顔が真っ赤になる気がした。 そういうことはその、ふたりきりのときなら嬉しいけど、 いまは後藤先生の前だし……。わたしはそっぽを向いて抗議する。</p>
<p>　後藤先生の〈眼鏡〉にウィンドウが表示されている。 どうやらメールしているみたいだ。</p>
<p>　後藤先生は左手の小指でたんと机を叩くような仕草をする。 〈指輪〉——ブレイン・マシン・インターフェイスの一種で、 指の神経への電気信号を理解し、空中でも机でもどこでも、 タップすることでクリックやダブルクリックができて、 指で空をなぞることでマウスポインタを動かせる、 マウスに代わる入力デバイス——を操作しているのだ。 その操作で、彼女は眼鏡に表示されたウィンドウを閉じ、 言う。</p>
<p>「真鳥さんはあと17分ほどで到着するようです。 真鳥さんが来てからまた話すことになるのは時間のムダですし、 詳しい話は彼女が到着してからにしましょう」</p>
<p>　ソフィーヤが即座に答える。</p>
<p>「賛成……です……」</p>
<p>　わたしは質問する。</p>
<p>「それまではどうします？」</p>
<p>「そうですね……では、いくつか出題します——今回の件にも関係のある ことです——あなたたちが授業で習ったことをしっかり身につけられているか どうか、抜き打ちテストです」</p>
<p>　ソフィーヤは眉ひとつ動かさないけど、わたしは心のなかで 思わず（ヒーッ）と叫んでいたし、たぶん顔にも出ていたと思うと、 恥ずかしくなる。</p>
<p>　後藤先生はにっこり笑う。</p>
<p>「答えられなくてもかまいませんよ。公式な 問題ではないし、成績には影響しませんので」</p>
<p>　わたしは冷や汗をかく。答えられる自信はほとんどない。</p>
<p>「それでは最初の問題です」と、後藤先生が切り出すけど、 「あっと、えっと、その前に……前提を共有しましょう。 一昨日——12月21日、冬休み初日ですね——、ソフィーヤさんは、 自宅からSSHで件のサーバにリモート・ログインした。 これは本人の証言です。これはあとで真鳥さんにも話すつもりですが、 アリスさんは、この事実をご存知ですか？」</p>
<p>「はい、道中、ソフィーヤから聞きました」</p>
<p>「ここから出題。まず、SSHはリモート・サーバと 安全に通信をするためのプロトコルです。 SSHにおける通信の安全は、公開鍵暗号と 共通鍵暗号という暗号技術によって担保されています。 ここで、共通鍵暗号とはどのような暗号技術か、 簡潔に答えなさい」</p>
<p>　選択問題じゃない！　選択なら消去法とかいろいろ 解き方の定石があるのに。こういう問題は苦手だ。</p>
<p>　そう思っていると、ソフィーヤがすらすらと答える。</p>
<p>「共通鍵暗号は……サーバとクライアントで……同じ鍵を使って暗号化をする 方式です……。共通鍵では……同じ鍵で暗号化したものを…… 同じ鍵で復号します……。 鍵は……あらかじめサーバとクライアントに同じものを用意しておくか…… 通信する直前に一度だけつくって共有するなどの方法で用意されます。 そして……同じ鍵を用意したうえで……その鍵で暗号化したデータを送信し…… 受信したデータをその鍵で復号するようにして……通信の安全を担保します……」</p>
<p>「よろしい。この方式では、鍵が漏れず、アルゴリズムに脆弱性がない かぎりは、基本的に絶対安全と言えます。ところが、共通鍵暗号には、ひとつ 重大な問題があります。それはなんでしょう」</p>
<p>　これはわかる！　わたしは手をあげて元気よく答える。</p>
<p>「はいはい！　わたしが答えます。共通鍵暗号は、鍵で暗号化したデータは 安全に通信できますが、鍵そのものをどうやって通信するのかという問題が あります」</p>
<p>「正解。つまり、もし攻撃者に 鍵の通信そのものが盗聴されてしまった場合、ほかの通信も攻撃者に 復号されてしまうということですね。ところで、 この問題をきれいとは言えないまでも現実的に解決する方法が公開鍵暗号です。 共通鍵暗号が、鍵をひとつしか用意しないのに対して、 公開鍵暗号は、鍵のペアを用意します。その鍵をそれぞれなんと言うでしょうか」</p>
<p>　これもわかる。わたしは続けて答える。</p>
<p>「公開鍵と、秘密鍵です」</p>
<p>「正解。ところで、この鍵のペアにはある性質があります。ここで、</p>
<ol>
<li>公開鍵で暗号化したものは、どの鍵で復号できるでしょうか。</li>
<li>秘密鍵で暗号化したものは、どの鍵で復号できるでしょうか」</li>
</ol>
<p>　ちょっとばかにされてるのかとも思うくらい簡単な問題。 わたしは答える。</p>
<p>「公開鍵で暗号化したものは、秘密鍵で復号できます。 秘密鍵で暗号化したものは、公開鍵で復号できます」</p>
<p>　ソフィーヤが落ち着いて付け加える。</p>
<p>「いまの言い方だと……公開鍵で暗号化したものを復号できるのは 秘密鍵だけではないようにも聞こえるけど……実際には…… 公開鍵で暗号化したものが復号されるのは秘密鍵を使ったとき、 またそのときにかぎる……秘密鍵で暗号化したものについても 同様」</p>
<p>　わたしは顔を真っ赤にして抗議する。</p>
<p>「わっ、わかってるわよ、それくらい。言わなくてもわかるでしょ」</p>
<p>　ソフィーヤは細い目でわたしを見て言う。</p>
<p>「事例は……ちゃんと列挙しないと……勘違いする人が……いるかも」</p>
<p>　後藤先生が続ける。</p>
<p>「次の問題。共通鍵暗号では、鍵の送受信が盗聴者に知られると、 通信が復号される可能性がありました。ところで、公開鍵暗号は 鍵の送受信はするものの、鍵が盗聴者に知られても、 通信は復号されない仕組みになっています。それは、 どのような仕組みか。簡潔に答えなさい」</p>
<p>　そんなの、わからない。</p>
<p>　わたしが目をまわしていると、ソフィーヤが答える。</p>
<p>「“公開鍵で暗号化したものを復号できるのは、秘密鍵だけ”という性質を 利用します……。サーバとクライアントで……それぞれ公開鍵と秘密鍵のペアを ひとつずつ生成し……公開鍵だけを交換します——このとき、 公開鍵は攻撃者に盗聴される危険性があるけど、 秘密鍵は攻撃者に盗聴される危険性はないということに注意して ください——ここで……データを公開鍵で暗号化して送信すれば…… “公開鍵で暗号化したものを復号できるのは、秘密鍵だけ”なのですから…… 攻撃者は秘密鍵を知らないのですから……安全というわけです」</p>
<p>「正しい。次の問題。ところで、SSHは安全にリモート・サーバと通信する ためのプロトコルです。SSHでサーバとクライアントが通信するとき、 SSHは、</p>
<ul>
<li>サーバ認証……サーバがハイジャックされていないかの確認</li>
<li>ユーザ認証……ユーザがハイジャックされていないかの確認</li>
<li>共通鍵暗号による通信の暗号化</li>
<li>公開鍵暗号による共通鍵暗号の鍵の暗号化</li>
</ul>
<p>などをして、通信の安全性を保証してくれます。 サーバとクライアントは、それぞれ公開鍵と秘密鍵のペアを 生成して、かつ、あらかじめ公開鍵は交換しておいたものと して——この公開鍵の交換は盗聴されても問題はありません——SSHが おこなう手順は、簡単には、</p>
<ol>
<li>クライアントは、ホスト公開鍵で、ランダムなデータを暗号化してサーバに 送信し、</li>
<li>サーバは、そのデータをホスト秘密鍵で復号してクライアントに送り返し、</li>
<li>クライアントは、送り返されたデータと、送ったはずのデータが一致するか 確かめて——公開鍵で暗号化したものを復号できるのは秘密鍵の所有者だけ なので、一致すればサーバがハイジャックされていないと確信できるわけ です——</li>
<li>クライアントは、共通鍵の鍵をつくり、それをホスト公開鍵で暗号化して サーバに送信し——この鍵は、やはり公開鍵で暗号化されているので、秘密鍵の 所有者しか復号できず、通信は安全です——</li>
<li>サーバは、クライアント公開鍵で、ランダムなデータを暗号化して クライアントに送信し、</li>
<li>クライアントは、そのデータをクライアント秘密鍵で復号して サーバに送り返し、</li>
<li>サーバは、送り返されたデータと、送ったはずのデータが一致するか 確かめて——公開鍵で暗号化したものを復号できるのは秘密鍵の所有者だけ なので、一致すればクライアントがハイジャックされていないと 確信できるわけです——</li>
<li>晴れてクライアント認証とサーバ認証が完了したので、 手順4でつくった共通鍵の鍵で通信を暗号化する</li>
</ol>
<p>という手順を踏むのですが——すいません、簡単にはと言いつつ、 ややこしく、複雑でした——要は、公開鍵暗号で鍵を暗号化して交換し、 その鍵で通信を暗号化することで安全に通信します。 これを前提として、いくつか出題します。 まず、このとき、公開鍵暗号としては、たいていRSA暗号が使われます。 ここで、RSA暗号はどのような公開鍵暗号か、簡潔に答えなさい」</p>
<p>　ソフィーヤがまるで教科書を暗記しているかのようにすらすらと答える。</p>
<p>「RSA暗号は……代表的な公開鍵暗号で…… 素数と素数を掛け合わせて合成数を求めるのは簡単だけど…… 合成数を素因数分解して素数と素数を求めることは難しいことを 根拠としています……たとえば、2048ビット長のRSA暗号を素因数分解で 解読するには……3×10<sup>20</sup>年の時間が必要とも言われていました…… 無条件安全性はありませんか……計算量的安全性はあるというやつです……」</p>
<p>「正しい。もっとも、その時間は古典コンピュータの進化とともに 短くなっていきます。 ところで、無条件安全性と計算量的安全性とはなにか。簡潔に説明せよ」</p>
<p>　これはわかる。わたしは説明する。</p>
<p>「無条件安全性というのは、解読が不可能という意味です。 鍵の長さが送信するデータと同じかそれ以上の長さであれば、 無条件に安全です。計算量的安全性とは、解読は可能だけど、 古典コンピュータでは解読するのに非現実的なほど長い時間がかかる ことです。同じアルゴリズムでも、単純に鍵の長さを長くすることで、 計算量的に安全になる可能性があります」</p>
<p>「そう。20年から30年前の古典コンピュータの時代では、 RSA暗号はとても頑丈な、計算量的に安全な暗号でした。 ところが、RSA暗号の脅威となる技術が現れました。つまり、 ある技術を使うと、RSA暗号の鍵をいくら長くしようとほぼ定数時間で 解読してしまう技術が現れました。それはなにか」</p>
<p>　わたしは授業で習った記憶を引っ掻き回す。 たしか、量子コンピュータでショアのアルゴリズムがなんとかとか……。</p>
<p>　そうこう考えているうちに、ソフィーヤが答えてしまう。</p>
<p>「……量子コンピュータ」</p>
<p>「そう。量子コンピュータで、あるアルゴリズムを走らせると、 素因数分解を高速に——たとえば2048ビット長のRSA暗号を ものの数秒で——処理できます。そのアルゴリズムとはなにか」</p>
<p>　わたしは即答する。</p>
<p>「ショアのアルゴリズム」</p>
<p>「そう。するとどうなったか。 RSA暗号は安全とは言えなくなって しまいました。 なぜなら、もともと RSA 暗号が安全な根拠は、 大きな整数の素因数分解に 3×10<sup>20</sup>年かかるからであって、 暗号化が絶対不可能というわけではなかったのに、 それがものの数秒で解けるようになってしまったからです。 ところで、RSA暗号は、SSHの根幹となる暗号です。 当然、SSHも、この影響を受けます。SSHのどの手順がこの 影響を受けるのか答えなさい」</p>
<p>　ソフィーヤがつまらなそうに答える。</p>
<p>「……ユーザの認証と……サーバの認証と……共通鍵の暗号化の部分です…… 2048ビットのRSA暗号が主流なので——それが ssh-keygen でつくられる 鍵のデフォルトの形式だからです——それらの部分が、もはや 安全ではないというか、危険です……」</p>
<p>「正しい。では、どのように影響を受けるのか答えなさい」</p>
<p>　ソフィーヤが続けて答える。</p>
<p>「たとえば……まず……攻撃者はホストの公開鍵を入手 します……どうやってホストの公開鍵を入手するのかというと…… ssh コマンドでホストにアクセスすれば簡単に入手できます…… それから……量子コンピュータでホストの公開鍵からホストの秘密鍵を 計算します……数分もあれば終わるはずです……秘密鍵がわかれば通信の一部が 解読できるようになるので……たとえば、SSHでリモート・ログインするときは、 手順の一部にホストの公開鍵で共通鍵の鍵を暗号化するものがありますが…… このホストの公開鍵で暗号化された共通鍵をホストの秘密鍵で解読することで…… 暗号化されたパケットをすべて解読できるようになるので…… TCPセッション・ハイジャックができます……」</p>
<p>　TCPセッション・ハイジャック。あるTCPのセッションになりすます パケットを横から送信することで、そのTCPを奪ってしまうこと。</p>
<p>　SSHによるリモート・ログインもTCPセッションのひとつだ。</p>
<p>　リモート・ログイン中のTCPをハイジャックする。</p>
<p>　すると、攻撃者はログイン中のセッションを横取りして、 サーバにログインできてしまう。</p>
<p>　それにしても、ソフィーヤはやっぱりすごい。</p>
<p>　理解度が違う。</p>
<p>　わたしが答えられない質問にも、すぐさま答えてしまう。</p>
<p>　ソフィーヤは大人しいけど、すっごく頭がいいってことを再確認した。</p>
<p>　後藤先生はいかめしい顔つきで続ける。声はふんわりしているんだけど、 顔はこわい。</p>
<p>「よろしい。ふたりとも、SSHでリモート・ログインすることがいかに 危険なのかよくわかっているようですね」</p>
<p>　そのとき、職員室にごーんごーんと鐘の音が鳴る。</p>
<p>　インターホンの音。</p>
<p>　こんな時間に来客は来ない。</p>
<p>　どうやら真鳥が到着したみたいだ。</p>
<p>　後藤先生が席を立ち、受話器をとって言う。</p>
<p>「いま、鍵を開けました。どうぞ入ってください」</p>
<p>　廊下から真鳥が入ってくる。彼女は一気に曇る眼鏡を 外すよりも先に、大きく頭を下げて叫ぶ。</p>
<p>「遅れてごめんなさい！　お待たせしました！」</p>
<p>　それから彼女は眼鏡を外し、結露を拭き取りながら、 ふらふらと歩いてくる。</p>
<p>　彼女は目がとても悪く、その眼鏡には度が入っている。</p>
<p>　眼鏡を外すと、そのぱっちりしたまつげがよく目立つ。</p>
<p>　危なっかしい歩き方。</p>
<p>　途中、彼女は腰を机にぶつけて、よろめく。</p>
<p>　腰に届きそうなストレートの黒髪がゆらゆら揺れる。</p>
<p>　彼女は眼鏡をつけながら席に座る。</p>
<p>　わたしは真鳥に挨拶する。</p>
<p>「こんばんは、真鳥」</p>
<p>　真鳥は目をうろうろさせながら答える。</p>
<p>「こんばんは……」</p>
<p>　わたしはいきなりジョークを思いついたので言う。</p>
<p>「良い知らせと悪い知らせがあるわ。どっちから聞きたい？」</p>
<p>　真鳥が指で耳を撫でながらたずねてくる。</p>
<p>「良い知らせから？」</p>
<p>「わたしたちのつくったサーバはなんの問題もなく、すべて正常に動作しているわ」</p>
<p>「じゃあ、悪い知らせって？」</p>
<p>「22番ポートもきちんと動いてたってことかしら」</p>
<p>　22番ポートというのは、sshサーバが普通使うポートのこと。</p>
<p>　真鳥の顔が青ざめる。彼女は耳たぶをいじりながら質問してくる。</p>
<p>「ポートは解放していなかったはず」</p>
<p>　そう。 sshサーバを動かすなら LAN 内でだけ。そう授業で習った。</p>
<p>　sshサーバを WAN 、つまりインターネットに向けて公開したいときは、 ポートを開放する必要がある。</p>
<p>　普通は、危険なのでしない。</p>
<p>　でも、だれかがそれをしてしまった。</p>
<p>　わたしは髪をかきあげて、平静を装いつつ言う。</p>
<p>「それが解放されていたのよ、どういうわけかね」</p>
<p>　そして、それはたぶん、ソフィーヤがやったこと。</p>
<p>　でも、どうして。</p>
<p>　ソフィーヤなら、危険とわかっていたはず。</p>
<p>　なら、なぜ？</p>
<p>　わたしたちの会話に割り込むように、後藤先生がせきをする。</p>
<p>「こほん。みんな集まりましたね。それでは、これから、みんなに集まってもらった 理由を説明します。夜も遅いのでさっさと進めましょう。 質問などがあればいつでもしてください」</p>
<p>　わたしたちは姿勢を正して聞く。</p>
<p>「まず、状況のまとめから入りましょう。 今日の昼頃、何者かがあなたたち3人のサーバに侵入して、 ある本校のルータにログインし、TCPパケットを改竄して Facebook Searchのすべてのページにマルウェアへの リンクを張りました。ここまではいいですね」</p>
<p>　ネットワークはルーティングという仕組みによって 成り立っている。ルーティングとは、TCPパケットの通り道のことで、 通常、複数のルータをたくさん繋げたもの。 TCPパケットというのは、ウェブサイトなどの情報を小さな単位に 分割したもの。 TCPパケットはルータからルータへ、バケツリレーのように転送される。 もし、その途中のルータがひとつでも偽のデータを転送して しまったら？　最終的に届くのは改竄されてしまったページ。つまり、 そのルータが偽のページを転送したことで、 そのルータを通して通信している〈マシン〉がアクセスするページが 改竄されてしまったということ。</p>
<p>　ソフィーヤが質問する。</p>
<p>「その……マルウェアとはいったいなんでしょう……いえ 一般的な単語の意味ではなく……定冠詞をつけた意味で……」</p>
<p>　後藤先生は答える。</p>
<p>「それが、なんなのかまだよくわかっていないのが現状です。 なにしろ、今日の午後発覚したわけですから」</p>
<p>「なるほど……解析は……可能なのでしょうか……」</p>
<p>「もちろん可能でしょうが、なにしろ冬休みでしかも 夜も遅いので関係ない人を働かせるのは後ろめたいものがありまして」</p>
<p>　ていうか、わたしたちはいいのか。まあ関係あると言えばあるけど。</p>
<p>　真鳥が質問する。</p>
<p>「あの、TCPパケットの改竄って、そんなに簡単にできるんですか？」</p>
<p>　後藤先生が答える。</p>
<p>「非常に難しいと思われます。わたしも、専門外なのでよく わからないんですが……Facebook SearchはGGH暗号で暗号化されていますが、 これはRSA暗号などと違って量子コンピュータでも解読できないはずなので、 現在の技術では、理論上不可能なはずです」</p>
<p>　そう。Facebook SearchはGGH暗号で暗号化されている。 そして、現在、GGH暗号を解読できる方法は存在しない……はず。</p>
<p>　でも、事実できてしまったのだから、その認識は改めないといけない。</p>
<p>「Facebook Searchはみなさん知ってのとおり世界有数のトラフィックを 誇る検索サイトです。犯人の目的は、おそらく大量のトラフィックが 集まる場所でマルウェアを配布することで間違ってダウンロード、 インストール、そして実行してしまった人の〈マシン〉を汚染すること だと考えられます」</p>
<p>　それはわかる。というか、それ以外に考えられないだろう。あくまで確認。</p>
<p>　後藤先生は続ける。</p>
<p>「これが現在わかっていることです。そして、今日あなたたちを 呼んだ理由は、ふたつあります。ひとつは、あなたたちの潔白を証明する ためにすこし質問させてもらうこと。ふたつめは、件のサーバを検査して もらうことです」</p>
<p>　わたしは質問する。</p>
<p>「検査とは、具体的には」</p>
<p>「まず第一に、sshサーバを停止などして、 更なる被害を抑えること。これはわかりますね」</p>
<p>　ソフィーヤが申し訳なさそうに答える。</p>
<p>「はい……」</p>
<p>「第二に、ログなど、犯人に繋がる手がかりがないか 調べること。第三に——これはオプショナルとして、可能なら——ログなどの手がかり から犯人を突き止めること」</p>
<p>　真鳥が目を丸くして聞き返す。</p>
<p>「犯人を、わたしたちが捕まえるんですか！？」</p>
<p>「できなければ諦めてもいいです。でも、それができれば、 学院およびソフィーヤさんをはじめあなたたちの名誉が回復します。 その功績を、わたしは正式に学校に報告します。 できなければ……やはり、この事件を、わたしは正式に学校に報告します。 そのあとどういう処分がなされるかは、もはや、 わたしの手には負えません」</p>
<p>　わたしはぞくりとする。後藤先生が言っているのは、警告だ。 つまり、なんらかの処分を受けたくなければ、犯人を突き止めてみせろと 言っているのだ。</p>
<p>　後藤先生がおそろしげに言う。</p>
<p>「冬休みが明けるまでは、報告を保留しておきます。 1月7日、日曜日、冬休みの最後の日、 わたしはことの経緯とすべての結果を学校に 報告します。今日、とりあえずsshサーバが停止したことを 確認したら、あとは、わたしは関与しません。 わたしは、選択するために必要な知識をきちんと開示したつもりです。 あとは、あなたたち次第です」</p>
<p>　わたしたち次第。処分を回避できるかどうかは、 わたしたちの行動次第。</p>
<p>　わたしは迷う。今回の件で、いちばん悪い処分を受けるのは、 たぶんソフィーヤ、わたしの親友だ。もし、問題を真鳥が起こしたというのなら、 わたしは自業自得だと言って、今日はさっさと帰っていただろう。 でも、問題を起こしたのはソフィーヤだ。もし、わたしがソフィーヤと 無関係な第三者で、この事件をニュースかなにかで知っていたとすれば、 わたしはソフィーヤの自業自得だと言っていただろう。でも、あろうことか、 焦点は大好きな親友に合っているのだ。</p>
<p>　わたしは、ソフィーヤの助けになってあげたい。</p>
<p>　彼女がどう考えてどういう選択をしたのだとしても、それを 支えてあげたい。</p>
<p>　わたしは決意する。</p>
<p>　わたしは立ち上がって、前にどんと踏み出し、叫ぶ。</p>
<p>「ソフィーヤ、真鳥、わたしについてきなさい！　こんな事件を起こした 不埒ものを突き止めるのよ」</p>
<p>　ソフィーヤが静かに答える。</p>
<p>「わたしはいいけど……真鳥は……」</p>
<p>　わたしは真鳥をぎらりと睨みつける。</p>
<p>　真鳥はびっくりして素っ頓狂な声をあげる。</p>
<p>「もっ、もちろんっ、わたしも付き合いますよ」</p>
<p>「付、き、合、う？」</p>
<p>「いっ、いえ……言葉を間違えました。後学のために参加させていただきます！」</p>
<p>「よろしい」</p>
<p>　真鳥は耳をいじりながらたずねてくる。</p>
<p>「でも、今日は、その、もう帰らないと……終電が……」</p>
<p>「泊まればいいじゃない、寮があるんだから」</p>
<p>「はっ、はい……」</p>
<p>　こうして、わたしたちはサーバを検査し、 メンテし、犯人の痕跡を調査し、また犯人を突き止めるために、 冬休みのあいだ、寮に泊まり込むことになったのだ。</p>
<h1>Methods</h1>
<p>　2045年12月23日土曜日の午後8時。夜中の学校の廊下は、 吐いた息が白くなる程度に冷え込んでいて、暖房が効いていて暖かい 職員室からでた直後、温度差でわたしは思わず内股になり、足をかくかくさせた。</p>
<p>　こんな時間にわたしたちを呼び出しておいて、後藤先生は 職員室に残って、わたしと、ソフィーヤと、真鳥にサーバを調査させる。 ちなみに、ちょっと考えればわかることだけど、なぜインターネットが 全盛のこのこの時代に、リモートでサーバを管理するのではなくわざわざ 学校まで出向いて管理するのかというと、管理するために SSHでリモート・ログインするのは現状危険なので、物理サーバまで 出向いてLANから管理する方が安全だからだ。</p>
<p>　わたしが廊下を先導するように歩き、それにソフィーヤと真鳥が 並んで続く。</p>
<p>　わたしは両肩を両手で抱くようにして寒さを堪え、 ふとソフィーヤにたずねる。</p>
<p>「ソフィーヤ、モスクワと京都、どっちのほうが寒い？」</p>
<p>　ソフィーヤは小さな声で答える。</p>
<p>「体感では……京都の方が……寒いかも」</p>
<p>　真鳥が意外そうに声をあげる。</p>
<p>「ロシアって、日本より寒いのかと思ってました」</p>
<p>　ソフィーヤが答える。</p>
<p>「気温で測ると……モスクワのほうが寒いと思うけど……というのも……モスクワでは、 雪はもうちょっと降るのと……道路は凍る……でも……京都は廊下に暖房がないから…… 屋内なのに寒い……」</p>
<p>　わたしはそういえばと思って言う。</p>
<p>「日本の家ってセントラル・ヒーティングがないわよね」</p>
<p>　真鳥がたずねてくる。</p>
<p>「セントラル・ヒーティング？」</p>
<p>「まあ、調べてみて」</p>
<p>　それから職員室のある校舎を離れて学生寮へ。</p>
<p>　わたしたちの部屋に戻り、電灯をつける。</p>
<p>　真鳥が部屋を見渡し、感嘆する。</p>
<p>「久しぶり。3日しか離れてないのに、なんだか、 ついに戻ってきたって感じ」</p>
<p>　わたしは言う。</p>
<p>「とりあえず、わたしがキーボード使うから、ふたりは見ててね」</p>
<p>　わたしはさっそく机に座り、静電容量方式タッチ キーボードを起動する。</p>
<p>　3人で来たけど、この部屋にキーボードはひとつしかないので、 実際のところ、サーバをメンテできるのはひとりだけ。</p>
<p>　それから、左手の小指にはめた〈指輪〉を 小指の指の腹で、〈眼鏡〉の右の蝶番を右手の人差し指と 親指で、それぞれ抑えて、2秒間待つ。それは、〈指輪〉や〈眼鏡〉の接続する 先を別の端末に変更するときにする操作だ。2秒後、眼鏡に物理サーバ上で 動作する仮想マシンで動くOSの上で動く ブラウザ上で動く端末エミュレータが表示される。 試しに〈指輪〉を動かすと、端末エミュレータ上でマウスポインタが動く。 いま、わたしの〈指輪〉と〈眼鏡〉がサーバに接続された。</p>
<p>　ソフィーヤと真鳥も、〈眼鏡〉と〈指輪〉をサーバに接続して、わたしの 操作する端末を表示する。</p>
<p>　3人の〈指輪〉のポインタが、サーバ上で共有されて、わたしの〈眼鏡〉に 表示される。このように、ディスプレイとポインタは共有できるけど、 キーボードがひとつしかないので、実際に作業できるのはわたし ひとりだ。</p>
<p>　したがって、ふたりはわたしの作業に注目して、必要なら アドバイスをしてくれるような形になる。</p>
<p>　見られてると、ちょっと恥ずかしい。</p>
<p>　わたしも、ソフィーヤほどではないにしろ、工学の分野に進路をとる女子だ。 サーバのログがどこに保管されているのかくらいはわかる。</p>
<p>　まず、わたしはsshサーパのログを確認する。sshサーバには、確かに 一昨日から何度かログイン履歴があった。12月21日の昼頃のログイン履歴の グローバルIPアドレスは、たしかにわたしの電話帳に登録したソフィーヤの ものと一致していて、つまりこの履歴はソフィーヤのものらしかった。</p>
<p>　そのあと、ソフィーヤは何度かログインしなおしている。 でも、彼女のグローバルIPアドレスは、きっかり一昨日の分だけだ。</p>
<p>　それから、昨日、つまり12月22日の昼頃から、何者かの ログイン履歴があった。IPアドレスはIPv4だ。いまだIPv4を 使ってる人がいるのか……。IPv4からでは、たとえこのIPアドレスが本人の ものであるとしても、個人の特定は不可能だろう。そして、おそらく このIPアドレスは踏み台と呼ばれるものであり、このIPアドレスを 調べることは、労力の無駄だとわたしは考える。</p>
<p>　また、そのIPv4アドレスは、ソフィーヤのアカウントを使っている。 つまり、ソフィーヤの秘密鍵が盗まれているということだ。</p>
<p>　さすがにルートまでは盗られていない。ルートをとれなかったから、 不届きものはログを消すことはできなかったみたいだ。</p>
<p>　今日のログイン履歴はないようだ。</p>
<p>　わたしはみんなに伝える。</p>
<p>「どうやら、ソフィーヤの秘密鍵を使って何者か がソフィーヤの〈マシン〉以外の端末からログインしたことは、 まちがいないみたいね」</p>
<p>　真鳥が質問してくる。</p>
<p>「でも、犯人は、どうやってソフィーヤさんの秘密鍵を盗んだのでしょう」</p>
<p>　ソフィーヤがか細い声で答える。</p>
<p>「たぶん……最初のTCPセッション・ハイジャックで……犯人はサーバにログインした。 それから ~/.ssh/authorized<sub>keys</sub> というファイルをコピーした…… これには、わたしの公開鍵が登録されている。そして、そのファイルを量子 コンピュータで並列素因数分解し、公開鍵から秘密鍵を計算…… このようにして、盗人は、わたしの〈マシン〉に直接侵入することなく…… わたしの〈マシン〉にしかないはずの秘密鍵を盗んだのだと思う……」</p>
<p>　真鳥がきょどきょどと言う。</p>
<p>「ということは、不届きものはTCPセッション・ハイジャックをしたはずですね。 ルータにハイジャックの痕跡がないか調べましょう」</p>
<p>　わたしは答える。</p>
<p>「わかったわ」</p>
<p>　わたしはルータにログインしてTCPのログを調べる。</p>
<p>　調べようとしているのは、TCPセッション・ハイジャックの痕跡だ。</p>
<p>　TCPセッション・ハイジャックをする方法はいくつかあるけど、 TCPにおいて代表的なものは、TCPシーケンス番号予測攻撃と呼ばれる方法だ。</p>
<p>　TCPセッションは、TCPパケットというものを送受信する。 TCPパケットにはいくつか種類があるけど、そのすべては 送信元のIPアドレスとシーケンス番号を保持している。</p>
<p>　パケットは、通信するデータを小さな単位に分割したものだけど、 そのすべてが正しく通信できるとは限らない。たとえば、 順番が入れ替わって届いたり、途中で情報が欠落することもあり得る。</p>
<p>　そこで、TCPパケットは、シーケンス番号というものを、メタ情報として 持っている。シーケンス番号は、ある整数であり、 TCPセッションが確立したときに適当な番号が振られ、そのあとは前の TCPパケットのシーケンス番号に1を足した整数が振られる。</p>
<p>　受信側は、TCPパケットを受け取ったあと、シーケンス番号でソートする。 また、もしシーケンス番号が飛んでいたら、 途中でパケットが失われてしまったということなので、 送信側に再送依頼を送る。</p>
<p>　また、シーケンス番号が不正なパケットはすべて無視される。</p>
<p>　ところで、パケットに送信元のIPアドレスがくっついているけど、 じつは、これは簡単に詐称できてしまうのだ。このIPアドレスが正しいか どうか確かめるすべは、受信側にはなく、送られてきたデータを そのまま信用するしかない。</p>
<p>　これらの事実を組み合わせると、面白い攻撃ができる。 それがTCPシーケンス番号予測攻撃と呼ばれるものだ。</p>
<p>　まず、IPアドレスは簡単に詐称できることに注意して。</p>
<p>　それから、プロミスキャス・モードやARPキャッシュポイズニングなどの 方法でネットワークをスニッフィングし、TCPパケットの シーケンス番号を調べる。</p>
<p>　ここで、攻撃者は、正規のデータ送信者が、あるシーケンス番号の TCPパケットを送る前に、そのシーケンス番号を予測し、 そのシーケンス番号のTCPパケットを送信する。</p>
<p>　すると、受信者は、攻撃者のTCPパケットを受信した時点で、 それが本物だと思い込んでシーケンス番号をインクリメントする。 正規のデータ送信者の送ったはずのTCPパケットは、 不正なシーケンス番号なので、無視される。</p>
<p>　このようにして、攻撃者は、不正なデータを本物だと思い込ませて 送信することができる。</p>
<p>　通信というのは、パケットの送受信のことであるから、 不正なデータを送信できてしまえば、もはや、そのTCPセッションは、 乗っ取れたも同然だ。</p>
<p>　でも、そのためには、攻撃者は、TCPセッションを乗っ取るために、 偽のTCPパケットを送信する必要がある。</p>
<p>　つまり、おそらくは、その偽のTCPパケットが、ルータのログに残っている はずなのだ。</p>
<p>　でも、どのパケットが偽のTCPパケットであるかを判別するのは、 難しい。</p>
<p>　ただ、よく使われるものはある。</p>
<p>　それは、ACKパケットと呼ばれるものだ。</p>
<p>　TCPパケットの種類には、次のようなものがある。</p>
<ol>
<li>FINパケット</li>
<li>SYNパケット</li>
<li>RSTパケット</li>
<li>PSHパケット</li>
<li>ACKパケット</li>
<li>URGパケット</li>
</ol>
<p>　このうちで、ACKパケットというものを使って、 TCPセッション・ハイジャックをするのが、普通だ。</p>
<p>　そして、これらの種類は、TCPフラグというもので分別できる。 そして、それはログに記録しているはず。</p>
<p>　TCPフラグは、ただの整数で、TCPフラグが</p>
<ol>
<li>1——2進数で000001——ならFINパケット、</li>
<li>2——000010——ならSYNパケット、</li>
<li>4——000100——ならRSTパケット、</li>
<li>8——001000——ならPSHパケット、</li>
<li>16——010000——ならACKパケット、</li>
<li>32——100000——ならURGパケット</li>
</ol>
<p>というようになっている。</p>
<p>　フラグは整数値はでたらめではなく、2進数にしたときの 何桁めを1にするかどうかというようにして決まっている。</p>
<p>　これらのうちで、ACKパケットが、TCPシーケンス番号予測攻撃に よく使われるパケットだ。</p>
<p>　つまり、TCPフラグ16であるようなパケットに絞り込んで検索すれば、 見つかる可能性があるということ。</p>
<h1>Results</h1>
<h1>Discussion</h1>
<h1>Conclusion</h1>
<p class="local-vars">
(* Local Variables: *)<br />
(* Continued-from: nil *)<br />
(* Continued-on: nil *)<br />
(* Revision: &quot;ecae71b9eb7e04227dce875d90699be406e7826b&quot; *)<br />
(* End: *)<br />
</p>
</body>
</html>
