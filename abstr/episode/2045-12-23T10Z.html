<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Alice M. Lorenz" />
  <title>Sphiya's Last Theorem</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="../../pandoc/org.css" type="text/css" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<link rel="icon" href="../img/abstr.ico" type="image/vnd.microsoft.icon" />
</head>
<body>
<div id="header">
<h1 class="title">Sphiya's Last Theorem</h1>
<h2 class="author">Alice M. Lorenz</h2>
<h3 class="date">2046-01-07T11Z</h3>
</div>
<p align="center" class="file-vars">
(* -*- title: &quot;λ Abstraction&quot;; episode: &quot;Sophiya's Last Theorem&quot; -*- *)
</p>
<p align="center">
<a href="../"><img id="logo" src="../img/abstr-logo.png" 
/></a>
</p>
<p align="center" class="experimental">
<strong>これは実験的なページです。</strong>
内容が予告なく変更される可能性があります。
</p>
<p class="local-vars">
(* Local Variables: *)<br />
(* Continued-from: nil *)<br />
(* Continued-on: nil *)<br />
(* Version: &quot;0.0.6&quot; *)<br />
(* Stability: experimental *)<br />
(* Category: Novel *)<br /> 
(* End: *)<br />
</p>
<h1>Abstract</h1>
<p>　冬休みの3日めの夜。しんしんと降り続ける粉雪で、 道路が粉砂糖をかけたココアケーキみたい。 イルミネーションで豪勢に飾られたクリスマスツリーのために 道路は昼間のように明るい。</p>
<p>　仕事で疲れた社会人や 勉強をこなした学生が、みんな、帰りの電車に乗るために 京都駅へ吸い込まれるような流れをつくっている。</p>
<p>　そんななか、わたしは、京都駅から離れるように、 人の流れに逆らうようにして歩いている。</p>
<p>　目的地は京都λ抽象学院だ。</p>
<p>　なぜ、ほかのだれかではなく、よりにもよってこのわたしが 冬休みの3日めに学校へ出向くのかというと、 学校のわたしの住んでいる寮に設置されたサーバに、 昨日の昼頃、何者かが不正にログインし、Facebook Searchという 検索エンジンのTCPパケットを改竄してsearch.facebook.comドメイン以下の すべてのページにマルウェアへのリンクを張ったからだ。</p>
<p>　でも、たしかsearch.facebook.comはGGH暗号で暗号化されていたはず。</p>
<p>　GGH暗号というのは、格子暗号のひとつ。 格子暗号というのは、古典的な公開鍵暗号や楕円曲線暗号よりも安全な、 耐量子計算機暗号のひとつで、耐量子計算機暗号のうちでは もっとも主流のもの。</p>
<p>　耐量子計算機暗号を解読しなければ、TCPパケットの改竄はできない。</p>
<p>　search.facebook.comのTCPパケットを改竄するなんてこと、可能なのだろうか。</p>
<p>　ともあれ、京都λ抽象学院のルータを通して通信していたたくさんの 〈マシン〉がそのマルウェアに感染したことは事実としてあるらしく、 今日の午後それが発覚して、まず最初に疑われたのが、その 寮に住んでいる、わたしと、ソフィーヤと、真鳥の3人だったわけだ。</p>
<p>　耐量子計算機暗号で暗号化されたsearch.facebook.comが改竄された ということは、犯人は耐量子計算機暗号を解読してしまうほどの 技術力を持った人物ということになる。</p>
<p>　わたしと、ソフィーヤと、真鳥のうちで、そんなことが できる技術力を持っているとすればソフィーヤだけだ——彼女は 天才だ——けど、ソフィーヤはわたしの親友だし、 そんな悪いことをするはずがない。</p>
<p>　それに、動機だってないだろうし。</p>
<p>　それでも、わたしたちは疑われている。 身の潔白を主張するため、わたしは、いま京都λ抽象学院へ向かっている。</p>
<h1>Introduction</h1>
<p>　2045年12月23日土曜日午後7時前。 今日はわたしの誕生日だというのに、 わたしは京都駅からバス停へ向かっている。</p>
<p>　バス停でソフィーヤが待っていた。彼女はロシア人だから 寒さには強いと思ってたけど普通に厚着をしていた。</p>
<p>　わたしはカーディガンのポケットに両手を突っ込み、震えながら 彼女を見上げてたずねる。</p>
<p>「ロシア人はこの時期でも薄着かと思ってたけど」</p>
<p>　ソフィーヤは表情を変えず冷静に答える。</p>
<p>「アリス、ロシアはシベリアじゃない……モスクワの気温は……たぶん ザールラントと変わらない」</p>
<p>　アリスことわたしはドイツのザールラント出身。 ソフィーヤはロシアのモスクワ出身。ふたりとも留学生。</p>
<p>　わたしとソフィーヤは京都府に住んでいるから待ち合わせられたけど、 真鳥は兵庫県に住んでいるから時間がかかる。</p>
<p>　それにしても、こんな時間に兵庫県から呼び寄せるなんて、 後藤先生も鬼畜だと思う。</p>
<p>　わたしはぼそっとつぶやく。</p>
<p>「真鳥はたいへんねぇ……ひょっとして今日は帰れないんじゃないかしら」</p>
<p>　ちらっとソフィーヤの顔を見ると、彼女の〈眼鏡〉には メールが表示されていた。彼女はメールを読みながら冷徹にも答える。</p>
<p>「寮があるから平気だと思う」</p>
<p>　バスが来たので、わたしとソフィーヤはバスに乗る。</p>
<p>　ソフィーヤは無言でなにかメールをしているみたい。</p>
<p>　わたしは唇を尖らせてそっぽを向いてたずねる。</p>
<p>「なに読んでるの」</p>
<p>　一緒にいるときにメールを読まれてると、 なんだか無視されてるみたいで。</p>
<p>　今日はわたしの誕生日だって、ほんとにわかってるのかしら。</p>
<p>　おめでとうの一言もなし？</p>
<p>　そんなわたしの気持ちも知らず、ソフィーヤは答える。</p>
<p>「後藤先生に質問してる……というのも……どこまで わかってるのか……掴んでおきたいから」</p>
<p>「サーバに侵入した犯人のこと？」</p>
<p>「そう……」</p>
<p>「ふん。悪いのは学院よ。セキュリティを怠ったのが悪いのよ」</p>
<p>「学院のセキュリティは……かなりしっかりしてると思うけど……」</p>
<p>「思う？　現在形？　わたしたち、意見が合うのね、わたしも 思っていたわよ——過去形であることに注意ね！——侵入された事実はないわ、 フィクションよ！　そうに違いないわ」</p>
<p>「……そうじゃないと思う……問題があったのは学院じゃなくて……むしろ生徒……」</p>
<p>「あらそう。なにか心当たりでも？」</p>
<p>　ソフィーヤは黙って目をうろうろさせ、うつむいてしまう。</p>
<p>　わたしはびっくりして思わずたずねる。</p>
<p>「……ほんとにあるの？」</p>
<p>「わたし……一昨日……サーバにログインしてた……リモートで……SSHで……」</p>
<p>　わたしは耳を疑う。ソフィーヤが？　サーバに？　ログイン？　リモート で？　SSHで？</p>
<p>　……量子コンピュータは市販されている。だから、SSHの 基盤になっているRSA暗号はすぐに解読されてしまう。まだGGH暗号に対応 していないSSHはほとんど信用ならない、 ログインするならLANでのみ、そう授業で習ったはず。</p>
<p>　SSHでリモート・ログインすると、TCPセッション・ハイジャックされる 可能性がある。だから、SSHでリモート・ログインすることは 危険なので校則で禁止されてる。</p>
<p>　でも、リモート・ログインは便利だから、ついつい使ってしまう。 盗聴される危険性があるのもわかるけど、 きっと、わたしだけは大丈夫だろう、そんな気持ちでみんな 使ってしまうんだ。</p>
<p>　わたしは確認する。</p>
<p>「ほんとなの……？」</p>
<p>　ソフィーヤはうなずく。</p>
<p>　鳥肌が立つ。緊張する。</p>
<p>　つまり、その、本当に原因はソフィーヤで、 秘密鍵が解読されて、パスワードが盗まれたってこと？</p>
<p>　もちろん犯人は別にいるとはいえ、そんな事実が発覚したら、 ソフィーヤはどうなるか。退学？　よくて停学？　サーバは 処分されるかも。同じ寮のわたしたちは？　どうなるかわからない。</p>
<p>　これから先の学校生活が破壊される。</p>
<p>　こわい。</p>
<p>　わたしは指をこねくり合わせて目を逸らし、たずねる。</p>
<p>「どっ、どうしてサーバにリモート・ログインしたのかしら」</p>
<p>「それはその……とあるファイルをサーバから〈マシン〉に コピーし忘れてたから……」</p>
<p>　とあるファイルがなんであるかは、たずねないほうがいいだろう。</p>
<p>　わたしはしどろもどろで言う。</p>
<p>「そう、残念、だわ……」</p>
<p>　バスが荒神口通りに着く。</p>
<p>　わたしとソフィーヤはそこで降りて、学校まで歩く。</p>
<p>　夜中の学校の、職員室の窓だけが光っている。</p>
<p>　わたしは門でインターホンを押す。</p>
<p>　インターホンのディスプレイに後藤先生の顔が写り、 彼女はおごそかに言う。</p>
<p>「いま、鍵を開けました。どうぞ入ってください」</p>
<p>　わたしとソフィーヤは学校のなかに入り、 職員室へ向かう。</p>
<p>　職員室の扉を開けると、温暖な空気が漏れ出てきて、 なかに入ると、眼鏡があっという間に曇る。</p>
<p>　わたしとソフィーヤは眼鏡を一度外し、結露を拭いてから 再度身に付ける。</p>
<p>　わたしたちは、目が悪いから眼鏡をしているわけではなくて、 この眼鏡はポケットにいれた〈マシン〉のディスプレイになっているのだ。</p>
<p>　また、表示できる情報は〈マシン〉のものだけではなく、 情報にアクセスさえできれば、パソコンのディスプレイのように なんでも表示できる。</p>
<p>　ただ、冬は暖かい部屋に入るとすぐ曇ってしまうのが難点だ。</p>
<p>　ところで、〈マシン〉というのは、いまの時代ならだいたい ひとりひとつは持っている、ポケットに入るくらいの小型デバイスのことだ。</p>
<p>　〈マシン〉にも種類はあるけど、たいていのスペックは128ビットCPUか 256ビットCPUで、メインメモリは512GB程度。マシンにはそれぞれ IPv6 によってグローバルIPアドレスが振られている。 OSはLinuxディストリビューションのいずれかであることが多い。 最近は16キュービットCPUや32キュービットCPUを積んだ〈量子マシン〉も あるらしいけど、わたしは持っていない。</p>
<p>　〈指輪〉で入力し、〈マシン〉が計算し、〈眼鏡〉が表示し、 〈イヤホン〉が鳴らし、〈嗅覚シール〉がにおわせてくれて、 〈味覚入れ歯〉があじあわせてくれる。</p>
<p>　これは、いまさら説明するまでもないような、当たり前のことだけど。</p>
<p>　ところで、職員室には後藤先生——わたしたちの担任——以外の先生はいない。</p>
<p>　わたしたちは後藤先生の机まで行く。</p>
<p>　後藤先生はしかめっ面で椅子に座っている。</p>
<p>　後藤先生がふだん通りの優しい口調で言う。</p>
<p>「どうぞ、空いている席はたくさんあります。お座りください」</p>
<p>　ソフィーヤは黙って言うとおりに座る。</p>
<p>　わたしはある椅子に座る前に高さを調節してから——つまり、 悔しいけど座席部分を可能な限り高くしてから——その椅子に座る。 それでもやや低過ぎる気がして悔しい。</p>
<p>　ソフィーヤがわたしを気遣ってくれたのか、何気なく言う。</p>
<p>「なんなら……わたしの膝の上に座っても……」</p>
<p>　わたしは顔が真っ赤になる気がした。 そういうことはその、ふたりきりのときなら嬉しいけど、 いまは後藤先生の前だし……。わたしはそっぽを向いて抗議する。</p>
<p>　後藤先生の〈眼鏡〉にウィンドウが表示されている。 どうやらメールしているみたいだ。</p>
<p>　後藤先生は左手の小指でたんと机を叩くような仕草をする。 〈指輪〉——ブレイン・マシン・インターフェイスの一種で、 指の神経への電気信号を理解し、空中でも机でもどこでも、 タップすることでクリックやダブルクリックができて、 指で空をなぞることでマウスポインタを動かせる、 マウスに代わる入力デバイス——を操作しているのだ。 その操作で、彼女は眼鏡に表示されたウィンドウを閉じ、 言う。</p>
<p>「真鳥さんはあと17分ほどで到着するようです。 真鳥さんが来てからまた話すことになるのは時間のムダですし、 詳しい話は彼女が到着してからにしましょう」</p>
<p>　ソフィーヤが即座に答える。</p>
<p>「賛成……です……」</p>
<p>　わたしは質問する。</p>
<p>「それまではどうします？」</p>
<p>「そうですね……では、いくつか出題します——今回の件にも関係のある ことです——あなたたちが授業で習ったことをしっかり身につけられているか どうか、抜き打ちテストです」</p>
<p>　ソフィーヤは眉ひとつ動かさないけど、わたしは心のなかで 思わず（ヒーッ）と叫んでいたし、たぶん顔にも出ていたと思うと、 恥ずかしくなる。</p>
<p>　後藤先生はにっこり笑う。</p>
<p>「答えられなくてもかまいませんよ。公式な 問題ではないし、成績には影響しませんので」</p>
<p>　わたしは冷や汗をかく。答えられる自信はほとんどない。</p>
<p>「それでは最初の問題です」と、後藤先生が切り出すけど、 「あっと、えっと、その前に……前提を共有しましょう。 一昨日——12月21日、冬休み初日ですね——、ソフィーヤさんは、 自宅からSSHで件のサーバにリモート・ログインした。 これは本人の証言です。これはあとで真鳥さんにも話すつもりですが、 アリスさんは、この事実をご存知ですか？」</p>
<p>「はい、道中、ソフィーヤから聞きました」</p>
<p>「ここから出題。まず、SSHはリモート・サーバと 安全に通信をするためのプロトコルです。 SSHにおける通信の安全は、公開鍵暗号と 共通鍵暗号という暗号技術によって担保されています。 ここで、共通鍵暗号とはどのような暗号技術か、 簡潔に答えなさい」</p>
<p>　選択問題じゃない！　選択なら消去法とかいろいろ 解き方の定石があるのに。こういう問題は苦手だ。</p>
<p>　そう思っていると、ソフィーヤがすらすらと答える。</p>
<p>「共通鍵暗号は……サーバとクライアントで……同じ鍵を使って暗号化をする 方式です……。共通鍵では……同じ鍵で暗号化したものを…… 同じ鍵で復号します……。 鍵は……あらかじめサーバとクライアントに同じものを用意しておくか…… 通信する直前に一度だけつくって共有するなどの方法で用意されます。 そして……同じ鍵を用意したうえで……その鍵で暗号化したデータを送信し…… 受信したデータをその鍵で復号するようにして……通信の安全を担保します……」</p>
<p>「よろしい。この方式では、鍵が漏れず、アルゴリズムに脆弱性がない かぎりは、基本的に絶対安全と言えます。ところが、共通鍵暗号には、ひとつ 重大な問題があります。それはなんでしょう」</p>
<p>　これはわかる！　わたしは手をあげて元気よく答える。</p>
<p>「はいはい！　わたしが答えます。共通鍵暗号は、鍵で暗号化したデータは 安全に通信できますが、鍵そのものをどうやって通信するのかという問題が あります」</p>
<p>「正解。つまり、もし攻撃者に 鍵の通信そのものが盗聴されてしまった場合、ほかの通信も攻撃者に 復号されてしまうということですね。ところで、 この問題をきれいとは言えないまでも現実的に解決する方法が公開鍵暗号です。 共通鍵暗号が、鍵をひとつしか用意しないのに対して、 公開鍵暗号は、鍵のペアを用意します。その鍵をそれぞれなんと言うでしょうか」</p>
<p>　これもわかる。わたしは続けて答える。</p>
<p>「公開鍵と、秘密鍵です」</p>
<p>「正解。ところで、この鍵のペアにはある性質があります。ここで、</p>
<ol>
<li>公開鍵で暗号化したものは、どの鍵で復号できるでしょうか。</li>
<li>秘密鍵で暗号化したものは、どの鍵で復号できるでしょうか」</li>
</ol>
<p>　ちょっとばかにされてるのかとも思うくらい簡単な問題。 わたしは答える。</p>
<p>「公開鍵で暗号化したものは、秘密鍵で復号できます。 秘密鍵で暗号化したものは、公開鍵で復号できます」</p>
<p>　ソフィーヤが落ち着いて付け加える。</p>
<p>「いまの言い方だと……公開鍵で暗号化したものを復号できるのは 秘密鍵だけではないようにも聞こえるけど……実際には…… 公開鍵で暗号化したものが復号されるのは秘密鍵を使ったとき、 またそのときにかぎる……秘密鍵で暗号化したものについても 同様」</p>
<p>　わたしは顔を真っ赤にして抗議する。</p>
<p>「わっ、わかってるわよ、それくらい。言わなくてもわかるでしょ」</p>
<p>　ソフィーヤは細い目でわたしを見て言う。</p>
<p>「事例は……ちゃんと列挙しないと……勘違いする人が……いるかも」</p>
<p>　後藤先生が続ける。</p>
<p>「次の問題。共通鍵暗号では、鍵の送受信が盗聴者に知られると、 通信が復号される可能性がありました。ところで、公開鍵暗号は 鍵の送受信はするものの、鍵が盗聴者に知られても、 通信は復号されない仕組みになっています。それは、 どのような仕組みか。簡潔に答えなさい」</p>
<p>　そんなの、わからない。</p>
<p>　わたしが目をまわしていると、ソフィーヤが答える。</p>
<p>「“公開鍵で暗号化したものを復号できるのは、秘密鍵だけ”という性質を 利用します……。サーバとクライアントで……それぞれ公開鍵と秘密鍵のペアを ひとつずつ生成し……公開鍵だけを交換します——このとき、 公開鍵は攻撃者に盗聴される危険性があるけど、 秘密鍵は攻撃者に盗聴される危険性はないということに注意して ください——ここで……データを公開鍵で暗号化して送信すれば…… “公開鍵で暗号化したものを復号できるのは、秘密鍵だけ”なのですから…… 攻撃者は秘密鍵を知らないのですから……安全というわけです」</p>
<p>「正しい。次の問題。ところで、SSHは安全にリモート・サーバと通信する ためのプロトコルです。SSHでサーバとクライアントが通信するとき、 SSHは、</p>
<ul>
<li>サーバ認証……サーバがハイジャックされていないかの確認</li>
<li>ユーザ認証……ユーザがハイジャックされていないかの確認</li>
<li>共通鍵暗号による通信の暗号化</li>
<li>公開鍵暗号による共通鍵暗号の鍵の暗号化</li>
</ul>
<p>などをして、通信の安全性を保証してくれます。 サーバとクライアントは、それぞれ公開鍵と秘密鍵のペアを 生成して、かつ、あらかじめ公開鍵は交換しておいたものと して——この公開鍵の交換は盗聴されても問題はありません——SSHが おこなう手順は、簡単には、</p>
<ol>
<li>クライアントは、ホスト公開鍵で、ランダムなデータを暗号化してサーバに 送信し、</li>
<li>サーバは、そのデータをホスト秘密鍵で復号してクライアントに送り返し、</li>
<li>クライアントは、送り返されたデータと、送ったはずのデータが一致するか 確かめて——公開鍵で暗号化したものを復号できるのは秘密鍵の所有者だけ なので、一致すればサーバがハイジャックされていないと確信できるわけ です——</li>
<li>クライアントは、共通鍵の鍵をつくり、それをホスト公開鍵で暗号化して サーバに送信し——この鍵は、やはり公開鍵で暗号化されているので、秘密鍵の 所有者しか復号できず、通信は安全です——</li>
<li>サーバは、クライアント公開鍵で、ランダムなデータを暗号化して クライアントに送信し、</li>
<li>クライアントは、そのデータをクライアント秘密鍵で復号して サーバに送り返し、</li>
<li>サーバは、送り返されたデータと、送ったはずのデータが一致するか 確かめて——公開鍵で暗号化したものを復号できるのは秘密鍵の所有者だけ なので、一致すればクライアントがハイジャックされていないと 確信できるわけです——</li>
<li>晴れてクライアント認証とサーバ認証が完了したので、 手順4でつくった共通鍵の鍵で通信を暗号化する</li>
</ol>
<p>という手順を踏むのですが——すいません、簡単にはと言いつつ、 ややこしく、複雑でした——要は、公開鍵暗号で鍵を暗号化して交換し、 その鍵で通信を暗号化することで安全に通信します。 これを前提として、いくつか出題します。 まず、このとき、公開鍵暗号としては、たいていRSA暗号が使われます。 ここで、RSA暗号はどのような公開鍵暗号か、簡潔に答えなさい」</p>
<p>　ソフィーヤがまるで教科書を暗記しているかのようにすらすらと答える。</p>
<p>「RSA暗号は……代表的な公開鍵暗号で…… 素数と素数を掛け合わせて合成数を求めるのは簡単だけど…… 合成数を素因数分解して素数と素数を求めることは難しいことを 根拠としています……たとえば、2048ビット長のRSA暗号を素因数分解で 解読するには……3×10<sup>20</sup>年の時間が必要とも言われていました…… 無条件安全性はありませんが……計算量的安全性はあるというやつです……」</p>
<p>「正しい。もっとも、その時間は古典コンピュータの進化とともに 短くなっていきます。 ところで、無条件安全性と計算量的安全性とはなにか。簡潔に説明せよ」</p>
<p>　これはわかる。わたしは説明する。</p>
<p>「無条件安全性というのは、解読が不可能という意味です。 鍵の長さが送信するデータと同じかそれ以上の長さであれば、 無条件に安全です。計算量的安全性とは、解読は可能だけど、 古典コンピュータでは解読するのに非現実的なほど長い時間がかかる ことです。同じアルゴリズムでも、単純に鍵の長さを長くすることで、 計算量的に安全になる可能性があります」</p>
<p>「そう。20年から30年前の古典コンピュータの時代では、 RSA暗号はとても頑丈な、計算量的に安全な暗号でした。 ところが、RSA暗号の脅威となる技術が現れました。つまり、 ある技術を使うと、RSA暗号の鍵をいくら長くしようとほぼ定数時間で 解読してしまう技術が現れました。それはなにか」</p>
<p>　わたしは授業で習った記憶を引っ掻き回す。 たしか、量子コンピュータでショアのアルゴリズムがなんとかとか……。</p>
<p>　そうこう考えているうちに、ソフィーヤが答えてしまう。</p>
<p>「……量子コンピュータ」</p>
<p>「そう。量子コンピュータで、あるアルゴリズムを走らせると、 素因数分解を高速に——たとえば2048ビット長のRSA暗号を ものの数秒で——処理できます。そのアルゴリズムとはなにか」</p>
<p>　わたしは即答する。</p>
<p>「ショアのアルゴリズム」</p>
<p>「そう。するとどうなったか。 RSA暗号は安全とは言えなくなって しまいました。 なぜなら、もともと RSA 暗号が安全な根拠は、 大きな整数の素因数分解に 3×10<sup>20</sup>年かかるからであって、 暗号化が絶対不可能というわけではなかったのに、 それがものの数秒で解けるようになってしまったからです。 ところで、RSA暗号は、SSHの根幹となる暗号です。 当然、SSHも、この影響を受けます。SSHのどの手順がこの 影響を受けるのか答えなさい」</p>
<p>　ソフィーヤがつまらなそうに答える。</p>
<p>「……ユーザの認証と……サーバの認証と……共通鍵の暗号化の部分です…… 2048ビットのRSA暗号が主流なので——それが ssh-keygen でつくられる 鍵のデフォルトの形式だからです——それらの部分が、もはや 安全ではないというか、危険です……」</p>
<p>「正しい。では、どのように影響を受けるのか答えなさい」</p>
<p>　ソフィーヤが続けて答える。</p>
<p>「たとえば……まず……攻撃者はホストの公開鍵を入手 します……どうやってホストの公開鍵を入手するのかというと…… ssh コマンドでホストにアクセスすれば簡単に入手できます…… それから……量子コンピュータでホストの公開鍵からホストの秘密鍵を 計算します……数分もあれば終わるはずです……秘密鍵がわかれば通信の一部が 解読できるようになるので……たとえば、SSHでリモート・ログインするときは、 手順の一部にホストの公開鍵で共通鍵の鍵を暗号化するものがありますが…… このホストの公開鍵で暗号化された共通鍵をホストの秘密鍵で解読することで…… 暗号化されたパケットをすべて解読できるようになるので…… TCPセッション・ハイジャックができます……」</p>
<p>　TCPセッション・ハイジャック。あるTCPのセッションになりすます パケットを横から送信することで、そのTCPセッションを奪ってしまうこと。</p>
<p>　SSHによるリモート・ログインもTCPセッションのひとつだ。</p>
<p>　リモート・ログイン中のTCPセッションをハイジャックする。</p>
<p>　すると、攻撃者はログイン中のセッションを横取りして、 サーバにログインできてしまう。</p>
<p>　それにしても、ソフィーヤはやっぱりすごい。</p>
<p>　理解度が違う。</p>
<p>　わたしが答えられない質問にも、すぐさま答えてしまう。</p>
<p>　ソフィーヤは大人しいけど、すっごく頭がいいってことを再確認した。</p>
<p>　後藤先生はいかめしい顔つきで続ける。声はふんわりしているんだけど、 顔はこわい。</p>
<p>「よろしい。ふたりとも、SSHでリモート・ログインすることがいかに 危険なのかよくわかっているようですね」</p>
<p>　そのとき、職員室にごーんごーんと鐘の音が鳴る。</p>
<p>　インターホンの音。</p>
<p>　こんな時間に来客は来ない。</p>
<p>　どうやら真鳥が到着したみたいだ。</p>
<p>　後藤先生が席を立ち、受話器をとって言う。</p>
<p>「いま、鍵を開けました。どうぞ入ってください」</p>
<p>　廊下から真鳥が入ってくる。彼女は一気に曇る眼鏡を 外すよりも先に、大きく頭を下げて叫ぶ。</p>
<p>「遅れてごめんなさい！　お待たせしました！」</p>
<p>　それから彼女は眼鏡を外し、結露を拭き取りながら、 ふらふらと歩いてくる。</p>
<p>　彼女は目がとても悪く、その眼鏡には度が入っている。</p>
<p>　眼鏡を外すと、そのぱっちりしたまつげがよく目立つ。</p>
<p>　危なっかしい歩き方。</p>
<p>　途中、彼女は腰を机にぶつけて、よろめく。</p>
<p>　腰に届きそうなストレートの黒髪がゆらゆら揺れる。</p>
<p>　彼女は眼鏡をつけながら席に座る。</p>
<p>　わたしは真鳥に挨拶する。</p>
<p>「こんばんは、真鳥」</p>
<p>　真鳥は目をうろうろさせながら答える。</p>
<p>「こんばんは……」</p>
<p>　わたしはいきなりジョークを思いついたので言う。</p>
<p>「良い知らせと悪い知らせがあるわ。どっちから聞きたい？」</p>
<p>　真鳥が指で耳を撫でながらたずねてくる。</p>
<p>「良い知らせから？」</p>
<p>「わたしたちのつくったサーバはなんの問題もなく、すべて正常に動作しているわ」</p>
<p>「じゃあ、悪い知らせって？」</p>
<p>「22番ポートもきちんと動いてたってことかしら」</p>
<p>　22番ポートというのは、sshサーバが普通使うポートのこと。</p>
<p>　真鳥の顔が青ざめる。彼女は耳たぶをいじりながら質問してくる。</p>
<p>「ポートは開放していなかったはず」</p>
<p>　そう。 sshサーバを動かすなら LAN 内でだけ。そう授業で習った。</p>
<p>　sshサーバを WAN 、つまりインターネットに向けて公開したいときは、 ポートを開放する必要がある。</p>
<p>　普通は、危険なのでしない。</p>
<p>　でも、だれかがそれをしてしまった。</p>
<p>　わたしは髪をかきあげて、平静を装いつつ言う。</p>
<p>「それが開放されていたのよ、どういうわけかね」</p>
<p>　そして、それはたぶん、ソフィーヤがやったこと。</p>
<p>　でも、どうして。</p>
<p>　ソフィーヤなら、危険とわかっていたはず。</p>
<p>　なら、なぜ？</p>
<p>　わたしたちの会話に割り込むように、後藤先生がせきをする。</p>
<p>「こほん。みんな集まりましたね。それでは、これから、みんなに集まってもらった 理由を説明します。夜も遅いのでさっさと進めましょう。 質問などがあればいつでもしてください」</p>
<p>　わたしたちは姿勢を正して聞く。</p>
<p>「まず、状況のまとめから入りましょう。 今日の昼頃、何者かがあなたたち3人のサーバに侵入して、 ある本校のルータにログインし、TCPパケットを改竄して Facebook Searchのすべてのページにマルウェアへの リンクを張りました。なお、このことは今日の午後ある生徒の報告により 発覚しました。ここまではいいですね」</p>
<p>　ネットワークはルーティングという仕組みによって 成り立っている。ルーティングとは、TCPパケットの通り道のことで、 通常、複数のルータをたくさん繋げたもの。 TCPパケットというのは、ウェブサイトなどの情報を小さな単位に 分割したもの。 TCPパケットはルータからルータへ、バケツリレーのように転送される。 もし、その途中のルータがひとつでも偽のデータを転送して しまったら？　最終的に届くのは改竄されてしまったページ。つまり、 そのルータが偽のページを転送したことで、 そのルータを通して通信している〈マシン〉がアクセスするページが 改竄されてしまったということ。</p>
<p>　ソフィーヤが質問する。</p>
<p>「その……マルウェアとはいったいなんでしょう……いえ 一般的な単語の意味ではなく……定冠詞をつけた意味で……」</p>
<p>　後藤先生は答える。</p>
<p>「それが、なんなのかまだよくわかっていないのが現状です。 なにしろ、今日の午後発覚したわけですから」</p>
<p>「なるほど……解析は……可能なのでしょうか……」</p>
<p>「もちろん可能でしょうが、現在、Facebook Searchに該当のリンクは存在せず、 マルウェアの入手さえも困難な状況にあります。感染した〈マシン〉を 調査すればなにかわかると思いますが、なにしろ冬休みでしかも 夜も遅いので関係ない人を働かせるのは後ろめたいものがありまして」</p>
<p>　ていうか、わたしたちはいいのか。まあ関係あると言えばあるけど。</p>
<p>　真鳥が質問する。</p>
<p>「あの、TCPパケットの改竄って、そんなに簡単にできるんですか？」</p>
<p>　後藤先生が答える。</p>
<p>「非常に難しいと思われます。わたしも、専門外なのでよく わからないんですが……Facebook SearchはGGH暗号で暗号化されていますが、 これはRSA暗号などと違って量子コンピュータでも解読できないはずなので、 現在の技術では、理論上不可能なはずです」</p>
<p>　そう。Facebook SearchはGGH暗号で暗号化されている。 そして、現在、GGH暗号を解読できる方法は存在しない……はず。</p>
<p>　でも、事実できてしまったのだから、その認識は改めないといけない。</p>
<p>「Facebook Searchはみなさん知ってのとおり世界有数のトラフィックを 誇る検索サイトです。犯人の目的は、おそらく大量のトラフィックが 集まる場所でマルウェアを配布することで間違ってダウンロード、 インストール、そして実行してしまった人の〈マシン〉を汚染すること だと考えられます」</p>
<p>　それはわかる。というか、それ以外に考えられないだろう。あくまで確認。</p>
<p>　後藤先生は続ける。</p>
<p>「これが現在わかっていることです。そして、今日あなたたちを 呼んだ理由は、ふたつあります。ひとつは、あなたたちの潔白を証明する ためにすこし質問させてもらうこと。ふたつめは、件のサーバを検査して もらうことです」</p>
<p>　わたしは質問する。</p>
<p>「検査とは、具体的には」</p>
<p>「まず第一に、sshサーバを停止などして、 更なる被害を抑えること。これはわかりますね」</p>
<p>　ソフィーヤが申し訳なさそうに答える。</p>
<p>「はい……」</p>
<p>「第二に、ログなど、犯人に繋がる手がかりがないか 調べること。第三に——これはオプショナルとして、可能なら——ログなどの手がかり から犯人を突き止めること」</p>
<p>　真鳥が目を丸くして聞き返す。</p>
<p>「犯人を、わたしたちが捕まえるんですか⁉」</p>
<p>「できなければ諦めてもいいです。でも、それができれば、 学院およびソフィーヤさんをはじめあなたたちの名誉が回復します。 その功績を、わたしは正式に学校に報告します。 できなければ……やはり、この事件を、わたしは正式に学校に報告します。 そのあとどういう処分がなされるかは、もはや、 わたしの手には負えません」</p>
<p>　わたしはぞくりとする。後藤先生が言っているのは、警告だ。 つまり、なんらかの処分を受けたくなければ、犯人を突き止めてみせろと 言っているのだ。</p>
<p>　後藤先生がおそろしげに言う。</p>
<p>「冬休みが明けるまでは、報告を保留しておきます。 1月7日、日曜日、冬休みの最後の日、 わたしはことの経緯とすべての結果を学校に 報告します。今日、とりあえずsshサーバが停止したことを 確認したら、あとは、わたしは関与しません。 わたしは、選択するために必要な知識をきちんと開示したつもりです。 あとは、あなたたち次第です」</p>
<p>　わたしたち次第。処分を回避できるかどうかは、 わたしたちの行動次第。</p>
<p>　わたしは迷う。今回の件で、いちばん悪い処分を受けるのは、 たぶんソフィーヤ、わたしの親友だ。もし、問題を真鳥が起こしたというのなら、 わたしは自業自得だと言って、今日はさっさと帰っていただろう。 でも、問題を起こしたのはソフィーヤだ。もし、わたしがソフィーヤと 無関係な第三者で、この事件をニュースかなにかで知っていたとすれば、 わたしはソフィーヤの自業自得だと言っていただろう。でも、あろうことか、 焦点は大好きな親友に合っているのだ。</p>
<p>　わたしは、ソフィーヤの助けになってあげたい。</p>
<p>　彼女がどう考えてどういう選択をしたのだとしても、それを 支えてあげたい。</p>
<p>　わたしは決意する。</p>
<p>　わたしは立ち上がって、前にどんと踏み出し、叫ぶ。</p>
<p>「ソフィーヤ、真鳥、わたしについてきなさい！　こんな事件を起こした 不埒ものを突き止めるのよ」</p>
<p>　ソフィーヤが静かに答える。</p>
<p>「わたしはいいけど……真鳥は……」</p>
<p>　わたしは真鳥をぎらりと睨みつける。</p>
<p>　真鳥はびっくりして素っ頓狂な声をあげる。</p>
<p>「もっ、もちろんっ、わたしも付き合いますよ」</p>
<p>「付、き、合、う？」</p>
<p>「いっ、いえ……言葉を間違えました。後学のために参加させていただきます！」</p>
<p>「よろしい」</p>
<p>　真鳥は耳をいじりながらたずねてくる。</p>
<p>「でも、今日は、その、もう帰らないと……終電が……」</p>
<p>「泊まればいいじゃない、寮があるんだから」</p>
<p>「はっ、はい……」</p>
<p>　こうして、わたしたちはサーバを検査し、 メンテし、犯人の痕跡を調査し、また犯人を突き止めるために、 冬休みのあいだ、寮に泊まり込むことになったのだ。</p>
<h1>Methods</h1>
<h2>First</h2>
<p>　2045年12月23日土曜日の午後8時。夜中の学校の廊下は、 吐いた息が白くなる程度に冷え込んでいて、暖房が効いていて暖かい 職員室からでた直後、温度差でわたしは思わず内股になり、足をかくかくさせた。</p>
<p>　こんな時間にわたしたちを呼び出しておいて、後藤先生は 職員室に残って、わたしと、ソフィーヤと、真鳥にサーバを調査させる。 ちなみに、ちょっと考えればわかることだけど、なぜインターネットが 全盛のこのこの時代に、リモートでサーバを管理するのではなくわざわざ 学校まで出向いて管理するのかというと、管理するために SSHでリモート・ログインするのは現状危険なので、物理サーバまで 出向いてLANから管理する方が安全だからだ。</p>
<p>　わたしが廊下を先導するように歩き、それにソフィーヤと真鳥が 並んで続く。</p>
<p>　わたしは両肩を両手で抱くようにして寒さを堪え、 ふとソフィーヤにたずねる。</p>
<p>「ソフィーヤ、モスクワと京都、どっちのほうが寒い？」</p>
<p>　ソフィーヤは小さな声で答える。</p>
<p>「体感では……京都の方が……寒いかも」</p>
<p>　真鳥が意外そうに声をあげる。</p>
<p>「ロシアって、日本より寒いのかと思ってました」</p>
<p>　ソフィーヤが答える。</p>
<p>「気温で測ると……モスクワのほうが寒いと思うけど……というのも……モスクワでは、 雪はもうちょっと降るのと……道路は凍る……でも……京都は廊下に暖房がないから…… 屋内なのに寒い……」</p>
<p>　わたしはそういえばと思って言う。</p>
<p>「日本の家ってセントラル・ヒーティングがないわよね」</p>
<p>　真鳥がたずねてくる。</p>
<p>「セントラル・ヒーティング？」</p>
<p>「まあ、調べてみて」</p>
<p>　それから職員室のある校舎を離れて学生寮へ。</p>
<p>　わたしたちの部屋に戻り、電灯をつける。</p>
<p>　真鳥が部屋を見渡し、感嘆する。</p>
<p>「久しぶり。3日しか離れてないのに、なんだか、 ついに戻ってきたって感じ」</p>
<p>　わたしは言う。</p>
<p>「とりあえず、わたしがキーボード使うから、ふたりは見ててね」</p>
<p>　わたしはさっそく机に座り、静電容量方式タッチ キーボードを起動する。</p>
<p>　3人で来たけど、この部屋にキーボードはひとつしかないので、 実際のところ、サーバをメンテできるのはひとりだけ。</p>
<p>　それから、左手の小指にはめた〈指輪〉を 小指の指の腹で、〈眼鏡〉の右の蝶番を右手の人差し指と 親指で、それぞれ抑えて、2秒間待つ。これは、〈指輪〉や〈眼鏡〉の接続する 先を別の端末に変更するときにする操作だ。2秒後、眼鏡に物理サーバ上で 動作する仮想マシンで動くOSの上で動く ブラウザ上で動く端末エミュレータが表示される。 試しに〈指輪〉を動かすと、端末エミュレータ上でマウスポインタが動く。 いま、わたしの〈指輪〉と〈眼鏡〉がサーバに接続された。</p>
<p>　ソフィーヤと真鳥も、〈眼鏡〉と〈指輪〉をサーバに接続して、わたしの 操作する端末を表示する。</p>
<p>　3人の〈指輪〉のポインタが、サーバ上で共有されて、わたしの〈眼鏡〉に 表示される。このように、ディスプレイとポインタは共有できるけど、 キーボードがひとつしかないので、実際に作業できるのはわたし ひとりだ。</p>
<p>　したがって、ふたりはわたしの作業に注目して、必要なら アドバイスをしてくれるような形になる。</p>
<p>　見られてると、ちょっと恥ずかしい。</p>
<p>　わたしも、ソフィーヤほどではないにしろ、工学の分野に進路をとる女子だ。 サーバのログがどこに保管されているのかくらいはわかる。</p>
<p>　まず、わたしはルータにログインし、ポート・フォワードの設定を変更して、 SSHによるリモート・ログインをできなくする。ポートが開きっぱなしだと、 またいつリモート・ログインされるか、わからない。</p>
<p>　そのあとsshサーバのログを確認する。sshサーバには、確かに 一昨日から何度かログイン履歴があった。12月21日の昼頃のログイン履歴の グローバルIPアドレスは、たしかにわたしの電話帳に登録したソフィーヤの ものと一致していて、つまりこの履歴はソフィーヤのものらしかった。</p>
<p>　そのあと、ソフィーヤは何度かログインしなおしている。 でも、彼女のグローバルIPアドレスは、きっかり一昨日の分だけだ。</p>
<p>　それから、昨日、つまり12月22日の昼頃から、何者かの ログイン履歴があった。IPアドレスはIPv4だ。いまだIPv4を 使ってる人がいるのか……。IPv4からでは、たとえこのIPアドレスが本人の ものであるとしても、個人の特定は不可能だろう。そして、おそらく このIPアドレスは踏み台と呼ばれるものであり、このIPアドレスを 調べることは、労力の無駄だとわたしは考える。</p>
<p>　また、そのIPv4アドレスは、ソフィーヤのアカウントを使っている。 つまり、ソフィーヤの秘密鍵が盗まれているということだ。</p>
<p>　さすがにルートまでは盗られていない。ルートをとれなかったから、 不届きものはログを消すことはできなかったみたいだ。</p>
<p>　今日のログイン履歴はないようだ。</p>
<p>　わたしはみんなに伝える。</p>
<p>「どうやら、ソフィーヤの秘密鍵を使って何者か がソフィーヤの〈マシン〉以外の端末からログインしたことは、 まちがいないみたいね」</p>
<p>　真鳥が質問してくる。</p>
<p>「でも、犯人は、どうやってソフィーヤさんの秘密鍵を盗んだのでしょう」</p>
<p>　ソフィーヤがか細い声で答える。</p>
<p>「たぶん……最初のTCPセッション・ハイジャックで……犯人はサーバにログインした。 それから ~/.ssh/authorized_keys というファイルをコピーした…… これには、わたしの公開鍵が登録されている。そして、そのファイルを量子 コンピュータで並列素因数分解し、公開鍵から秘密鍵を計算…… このようにして、盗人は、わたしの〈マシン〉に直接侵入することなく…… わたしの〈マシン〉にしかないはずの秘密鍵を盗んだのだと思う……」</p>
<p>　真鳥がきょどきょどと言う。</p>
<p>「ということは、不届きものはTCPセッション・ハイジャックをしたはずですね。 ルータにハイジャックの痕跡がないか調べましょう」</p>
<p>　わたしは聞き返す。</p>
<p>「TCPパケットのログを調べるということ？」</p>
<p>「そうです」</p>
<p>「そんな……たしかにわたしたちのサーバのトラフィックは 大したものじゃないけど——悲しいことにね！——でも、 人力でできる量だと思う？」</p>
<p>「ACKパケットだけをフィルタすれば……」</p>
<p>　ソフィーヤが静かに言う。</p>
<p>「やってみてできなければ……諦めればいい……やってみずに諦めるのは……早計」</p>
<p>　たしかにそうだ。わたしは答える。</p>
<p>「わかったわ」</p>
<p>　調べようとしているのは、TCPセッション・ハイジャックの痕跡だ。</p>
<p>　TCPセッション・ハイジャックをする方法はいくつかあるけど、 TCPにおいて代表的なものは、TCPシーケンス番号予測攻撃と呼ばれる方法だ。</p>
<p>　TCPセッションは、TCPパケットというものを送受信する。 TCPパケットにはいくつか種類があるけど、そのすべては 送信元のIPアドレスとシーケンス番号を保持している。</p>
<p>　パケットは、通信するデータを小さな単位に分割したものだけど、 そのすべてが正しく通信できるとは限らない。たとえば、 順番が入れ替わって届いたり、途中で情報が欠落することもあり得る。</p>
<p>　そこで、TCPパケットは、シーケンス番号というものを、メタ情報として 持っている。シーケンス番号は、ある整数であり、 TCPセッションが確立したときに適当な番号が振られ、そのあとは前の TCPパケットのシーケンス番号に1を足した整数が振られる。</p>
<p>　受信側は、TCPパケットを受け取ったあと、シーケンス番号でソートする。 また、もしシーケンス番号が飛んでいたら、 途中でパケットが失われてしまったということなので、 送信側に再送依頼を送る。</p>
<p>　また、シーケンス番号が不正なパケットはすべて無視される。</p>
<p>　ところで、パケットに送信元のIPアドレスがくっついているけど、 じつは、これは簡単に詐称できてしまうのだ。このIPアドレスが正しいか どうか確かめるすべは、受信側にはなく、送られてきたデータを そのまま信用するしかない。</p>
<p>　これらの事実を組み合わせると、面白い攻撃ができる。 それがTCPシーケンス番号予測攻撃と呼ばれるものだ。</p>
<p>　まず、IPアドレスは簡単に詐称できることに注意して。</p>
<p>　それから、プロミスキャス・モードやARPキャッシュポイズニングなどの 方法でネットワークをスニッフィングし、TCPパケットの シーケンス番号を調べる。</p>
<p>　ここで、攻撃者は、正規のデータ送信者が、あるシーケンス番号の TCPパケットを送る前に、そのシーケンス番号を予測し、 そのシーケンス番号のTCPパケットを送信する。</p>
<p>　すると、受信者は、攻撃者のTCPパケットを受信した時点で、 それが本物だと思い込んでシーケンス番号をインクリメントする。 正規のデータ送信者の送ったはずのTCPパケットは、 不正なシーケンス番号なので、無視される。</p>
<p>　このようにして、攻撃者は、不正なデータを本物だと思い込ませて 送信することができる。</p>
<p>　通信というのは、パケットの送受信のことであるから、 不正なデータを送信できてしまえば、もはや、そのTCPセッションは、 乗っ取れたも同然だ。</p>
<p>　でも、そのためには、攻撃者は、TCPセッションを乗っ取るために、 偽のTCPパケットを送信する必要がある。</p>
<p>　つまり、おそらくは、その偽のTCPパケットが、ログに残っている はずなのだ。</p>
<p>　でも、どのパケットが偽のTCPパケットであるかを判別するのは、 難しい。</p>
<p>　ただ、よく使われるものはある。</p>
<p>　それは、ACKパケットと呼ばれるものだ。</p>
<p>　TCPパケットの種類には、次のようなものがある。</p>
<ol>
<li>FINパケット</li>
<li>SYNパケット</li>
<li>RSTパケット</li>
<li>PSHパケット</li>
<li>ACKパケット</li>
<li>URGパケット</li>
</ol>
<p>　このうちで、ACKパケットというものを使って、 TCPセッション・ハイジャックをするのが、普通だ。</p>
<p>　そして、これらの種類は、TCPフラグというもので分別できる。 そして、それはログに記録しているはず。</p>
<p>　TCPフラグは、ただの整数で、TCPフラグが</p>
<ol>
<li>1——2進数で000001——ならFINパケット、</li>
<li>2——000010——ならSYNパケット、</li>
<li>4——000100——ならRSTパケット、</li>
<li>8——001000——ならPSHパケット、</li>
<li>16——010000——ならACKパケット、</li>
<li>32——100000——ならURGパケット</li>
</ol>
<p>というようになっている。</p>
<p>　フラグの整数値はでたらめではなく、2進数にしたときの 何桁めを1にするかどうかというようにして決まっている。</p>
<p>　これらのうちで、ACKパケットが、TCPシーケンス番号予測攻撃に よく使われるパケットだ。</p>
<p>　つまり、TCPフラグ16であるようなパケットに絞り込んで検索すれば、 見つかる可能性があるということ。</p>
<p>　わたしは、ACKパケットだけをフィルタして検索する。</p>
<p>　でも、TCPパケットのログは大量にある。</p>
<p>　いくらわたしたちのサーバのトラフィックが少ないと言っても、 半端な量ではない。</p>
<p>　でも、検索条件によっては可能性はある。 一昨日の昼頃のACKパケットにかぎれば、それほど多くはない。</p>
<p>　それから2時間ほど黙々と探す。 ソフィーヤと真鳥は暇になってしまったからか、 わたしを放ってベッドに横になりながら本を読んでいる。 何度かソフィーヤや真鳥と交代した。3人で力を合わせて何万行も ログを流し読み続けたとき、怪しいパケットを見つけた。</p>
<p>　同じシーケンス番号のACKパケットが、何度も繰り返し 送られてきている。</p>
<p>　そして、そのほとんどは無視されていて、なおかつ、 途中で一度だけ正常に処理されている。</p>
<p>　明らかにシーケンス番号予測攻撃の痕跡だ。</p>
<p>　真鳥が嬉しそうに言う。</p>
<p>「見つかりましたね」</p>
<p>「そうね。でもIPアドレスは詐称されたものよ」</p>
<p>「犯人を突き止める情報源にはならないけど、これは、 おそらくハイジャックされたという予測ではなく、 確実にハイジャックされたという証拠になります。 これは、ソフィーヤさんが犯人なのではなくて ただ利用されただけなのだという証拠ですよ」</p>
<p>　ソフィーヤが犯人ではない証拠。</p>
<p>　そう、じつは、いままでみんな口にはしなかったけど、 その証拠はなかった。</p>
<p>　そもそも、いままでの情報では、次のような可能性もあったのだ。</p>
<p>　つまり、ソフィーヤが事件を起こした、という可能性が。</p>
<p>　そもそも、情報を簡単に整理すれば、</p>
<ol>
<li>わたしたちのサーバに何者かがログインし、Facebook Searchを改竄し、</li>
<li>一昨日、ソフィーヤはサーバにログインした</li>
</ol>
<p>という事実があった。もし、第三者がこれを聞いたら、 犯人はソフィーヤなのだと考えてると思う。でも、わたしたちは、 そうであってはほしくないという思いから、ソフィーヤは真っ当な理由で ログインし、それを不届きものがハイジャックしたことで事件が起こった と考えた。</p>
<p>　ハイジャックされたということは、つじつまを合わせるために 必要な予想にすぎなかった。</p>
<p>　でも、いまは違う。その予想が、ログによって肯定された。 つまり、ソフィーヤがハイジャックされたというのは、 予想ではなく、事実なのだ。</p>
<p>　それが確信できただけでも、この2時間探したことはむだではなかったと 思う。</p>
<p>　それが終わったのが午後10時。さすがにみんなくたくただった。</p>
<p>　キーボードを叩くのも疲れてきたので、 わたしは真鳥にキーボードを交代する。</p>
<p>　真鳥が、そのほかに、サーバになにか手がかりが残っていないか調べる。</p>
<p>　真鳥がわたしたちにたずねてくる。</p>
<p>「冬休みに入ってから、みんな、ソフィーヤさん以外は、サーバにログインしてい ませんよね？」</p>
<p>　わたしはうなずく。リモート・ログインは禁止されている以上、 冬休みにログインするはずがない。</p>
<p>　真鳥はソフィーヤにたずねる。</p>
<p>「ソフィーヤさんは、サーバ上でなにかファイルを消除しました？」</p>
<p>　ソフィーヤは首を振る。</p>
<p>「なにも……消してないはず」</p>
<p>「おっけー。つまり、冬休みに入った12月21日の昼よりあとに 消除されたファイルは、すべて侵入者が消除したものだと言えますよね」</p>
<p>　わたしは理解して先に言う。</p>
<p>「復元するのね、消除されたファイルを」</p>
<p>「そう。 rm コマンドは、ディスクからファイルを消すわけではなくて、 ファイルへのポインタを消すだけ。すなわち、そのポインタを見つけだせば ファイルを復元できる。もちろん、その場所に新たなデータが書き込まれたり、 0で埋められたりしたら消えてしまうけど。運がよければ、侵入者が消したファイルが 復元できるはず」</p>
<p>　ソフィーヤが言う。</p>
<p>「侵入者が消したファイルには……なにか証拠が残っている可能性があるという ことね」</p>
<p>　わたしはほめる。</p>
<p>「真鳥、あったまいい！」</p>
<p>　真鳥は extundelete コマンドを実行する。 わたしは、もし大量に消除されていたら時間が かかるし、ひょっとしたら寝れなくなるなるんじゃないかなんて 思ったけど、そんなことはなかった。 大した量は消除されていなかったらしく、 コマンドは数秒で完了した。</p>
<p>　ディレクトリに消除されたファイルがすべて復元される。 わたしは期待を感じて思わずつぶやく。</p>
<p>「これが消除されたファイルの一覧ね」</p>
<p>　怪しいファイルがないか、真鳥が探す。 すると、なにやら怪しいファイルが発見される。</p>
<p>　シェルスクリプト。そのファイルを開いてみると、どうやら犯人が 犯行の際に使ったらしいコマンドや関数が記されている。</p>
<p>　その内容を見たとき、みんな、かなり犯人に近づいたと確信した。 というのも、変数にIPアドレスが記述されており、その IPアドレスからマルウェアをダウンロードするらしいコードが 書かれていた。このIPアドレスをたどれば、犯人に近づける可能性がある。</p>
<p>　どうやら、このシェルスクリプトは、 起動されると、そのIPアドレスからマルウェアをダウンロードし、わたしたちの サーバでホスティングしたうえで、バックグラウンドで常駐し、 起動されているあいだずっとFacebook Searchを改竄し、 マルウェアへのリンクを忍ばせ、また、1日ほど経った頃に自動的に プロセスを終了してこのシェルスクリプト自体や関連するファイルを すべて消除するという一連の処理を担っているようだ。</p>
<p>　でも、犯人はちょっと間抜けで、 rm したファイルが即座に消えるわけでは ないということを知らなかったみたいだ。</p>
<p>　わたしは真鳥に命令する。</p>
<p>「ちょっとそのIPアドレスにpingを打ってみてくれないかしら」</p>
<p>　ソフィーヤが口を挟む。</p>
<p>「こちらが調査しているとあちらに知られたら……対策される 可能性がある……ここは一度先生に報告すべきでは……」</p>
<p>　真鳥が反論する。</p>
<p>「でも、わたしたちはすでに侵入されているんですよ。 もし、pingを打っただけで調査していることがばれるほど セキュリティを講じているのなら、こちらのサーバであらかじめ 監視プログラムを走らせておくと思います——たとえば、 だれかがログインしたら所定のサーバにpingを打つようなプログラムを——だから、 その懸念はむだだと思います」</p>
<p>　ソフィーヤがちょっと考えてうなずく。</p>
<p>「たしかに……あなたは正しい」</p>
<p>　わたしは許可を下す。</p>
<p>「わたしが許可するわ。そのIPアドレスを調べましょう」</p>
<p>　真鳥は ping コマンドをその IPアドレスに向かって打つ。</p>
<p>　すると、レスポンスが帰ってくる。</p>
<p>　この IPアドレスは、生きている。</p>
<p>　つまり、犯人へ繋がっている可能性がある。</p>
<p>　わたしは命令する。</p>
<p>「シェルスクリプトのリンクに書かれたマルウェアをダウンロードしましょう。 サンプルとして保存しておいて、あとで仮想環境で検証するのよ」</p>
<p>　真鳥が wget コマンドでマルウェアをダウンロードする。</p>
<p>　リンクは生きてた。マルウェアがダウンロードされて保存される。</p>
<p>　ダウンロードしただけでは危険はない。危険なのは、それを実行してしまった とき。</p>
<p>　真鳥が楽しそうに言う。彼女は、犯人を捕まえるということ 以前に、この事件を楽しんでいるみたいだ。</p>
<p>「whois してみましょう」</p>
<p>　whois というのは、 IPアドレスの所有者を調べるコマンド。</p>
<p>　とはいえ、データベースに登録されていなければわからないし、 そもそも偽装されていることも多い。</p>
<p>　真鳥が whois で IPアドレスを調べる。</p>
<p>　コンソールに No match と表示される。</p>
<p>　どうやらデータベースに登録されていないらしい。</p>
<p>　ソフィーヤがなぜか安心したように胸を撫で下ろして言う。</p>
<p>「残念……」</p>
<p>　シェルスクリプトから得られる手がかりも、もうないようだし。</p>
<p>　マルウェアは放っておいても消えはしない。 それを調査するのは、後回しでもよさそうだ。</p>
<p>　わたしは提案する。</p>
<p>「そのIPアドレスをポート・スキャンしてみましょう。もしかしたら 穴が空いてるかも」</p>
<p>　ポート・スキャンというのは、待ち受け状態にあり、コネクション確立 要求を受け付けているポートを見つけ出すための方法。</p>
<p>　ポート・スキャンで見つけたポートは、開放されている。</p>
<p>　開放されているポートは、うまくすれば乗っ取ることができる 可能性がある。それができれば、こちらからそのIPアドレスにログインし、 さらに調査できる可能性が。</p>
<p>　ソフィーヤが静かに言う。</p>
<p>「するなら……ハーフ・オープン・スキャンを……」</p>
<p>　ハーフ・オープン・スキャンというのは、 ステルス型のポート・スキャンのことで、 TCPコネクションを確立せずにポート・スキャンできるので、 TCPコネクションを記録するツールではログに残らないなどの 特徴がある。</p>
<p>　真鳥が目をうろうろさせる。</p>
<p>「でも、わたし、C言語書けませんよ」</p>
<p>　ハーフ・オープン・スキャンをするのには、専用のプログラムを 書く必要があるのだけど、それを書くのにC言語を使う必要があり、 真鳥は書けないらしいのだ。</p>
<p>　というのも、わたしたち3人はみんな、Standard MLまたはその方言を使い、 C言語のようなプログラミング言語にはうとい。</p>
<p>　ソフィーヤが冷静に言う。</p>
<p>「C言語をどう使うのか知らないけど……ちゃんとハーフ・オープン・スキャンしない と……telnetとかでスキャンしてもいいけど……DoS攻撃と間違われて——もっとも、 ポート・スキャンはほとんどDoS攻撃だし——フィルタされるかも」</p>
<p>　正直、わたしもC言語をうまく使える自信はない。</p>
<p>　できるとすれば、ソフィーヤだけだ。</p>
<p>　わたしはソフィーヤにお願いする。</p>
<p>「ソフィーヤ、あなたは7つの言語を使えるでしょう。C言語も、たぶん できるのよね？　プログラミングしてみてくれないかしら」</p>
<p>　ソフィーヤはむすっとした顔をすると、 黙って真鳥の隣りまで行き、キーボードを交代する。</p>
<p>　ソフィーヤは小さな声で言う。</p>
<p>「C言語を書く必要はない……というのも……nmapを使えばいいから」</p>
<p>　真鳥がきょとんとして質問する。</p>
<p>「nmap？」</p>
<p>「そういう……ポート・スキャンをするソフトウェアがある……知らないのも…… 無理はないと思うけど」</p>
<p>　正直、わたしもハーフ・オープン・スキャンというのをどうやるのか 知らなくて、真鳥がそう言ったからてっきりC言語で書く必要があるのかと 思ったけど、ソフィーヤによれば専用のツールがあるみたい。</p>
<p>　ソフィーヤが nmap を使用してポート・スキャンを実施する。</p>
<p>　ポート・スキャンに時間がかかる。端末がのろのろと更新される。</p>
<p>　これは、nmapが遅いのではなくて、たぶんサーバが遅いのだろう。</p>
<p>　わたしはいらいらしてつぶやく。</p>
<p>「やけに遅いサーバね……」</p>
<p>　しばらくしてポート・スキャンが完了する。</p>
<p>　なんと、22番ポートや80番ポートが空いていた。</p>
<p>　つまり、SSHやHTTPがむき出しの状態になっているということだ。</p>
<p>　わたしは大声で言う。</p>
<p>「22番ポートが空いてる！　SSHが提供されているということよ。 うまくやれば、ログインできるかもしれないわ」</p>
<p>　HTTPはともかく、この時代にSSHは危険だ。</p>
<p>　逆に言うと、これはチャンスでもある。</p>
<p>　うまく暗号を解読すれば、SSHで犯人のサーバにログインできる可能性がある。</p>
<p>　真鳥が興奮しながら言う。彼女はたいへん楽しそうだ。</p>
<p>「犯人にされたことを、今度はこっちが仕返す版ですね！　サーバが稼働して いて、SSHが動いているということは、きっと、近いうちに 犯人はSSHでそのサーバにリモート・ログインしますよ——そうでないと、 ポートを開放している意味がありませんよ——そうですよ。 そうにちがいありません！　こちらもプログラムを常駐させて、 TCPセッション・ハイジャックを試みましょう」</p>
<p>　なるほど。たしかに、それは良い手かもしれない。</p>
<p>　ソフィーヤが計画の問題を指摘する。</p>
<p>「でも、そのためには、公開鍵から秘密鍵を計算できる量子コンピュータが 必要……というのも……わたしたちのサーバは256ビットCPUと16TBメモリを 備えているけど……このスペックの古典コンピュータだと何億年かかるか……」</p>
<p>　わたしは疑問を口にする。</p>
<p>「でも、わたしたちのサーバにも量子プロセッサはついてるでしょ？」</p>
<p>「あるけど……コア数やクロック数が足りないと思う」</p>
<p>「でも試してみればできるかも」</p>
<p>「べつに試してもいいけど……わたしは……たぶんできないと思う……あと…… そもそもの問題として……TCPセッション・ハイジャックするプログラム、 書ける、ふたりとも……？」</p>
<p>　真鳥はぶんぶん顔を横に振る。わたしも首を振る。</p>
<p>　真鳥が質問する。</p>
<p>「じゃあ、どうすれば？」</p>
<p>「地道に……さっきダウンロードしたマルウェアの検証をするのが確実だと 思う……」</p>
<p>　たしかに、それが確実だ。わたしは結論を下す。</p>
<p>「じゃあ、そうしましょう」</p>
<p>　時計を見ると、あと15分もすれば12時を回る時間になっていた。</p>
<p>　真鳥が急に目をうっとりとさせ、目をこすって言う。</p>
<p>「今日は……さすかに、もう眠いですね。 仮想環境の構築とマルウェアの検証には、時間がかかるでしょうし、 もう寝ましょう」</p>
<p>　わたしは答える。</p>
<p>「そうね」</p>
<p>　ソフィーヤも答える。</p>
<p>「賛成」</p>
<p>　わたしたちは、今日は寝ることにして、ベッドに潜り込む。</p>
<p>　わたしとソフィーヤは、まだ終電に間に合う可能性もあるけど、 真鳥はほとんど間に合わない。真鳥だけ置いてきぼりにするのも かわいそうだし、3人でひとつのベッドに入る。</p>
<p>　わたしの背が小さいので、わたしが真ん中で、ソフィーヤと真鳥が わたしを囲む。</p>
<p>　ベッドはレースのカーテンで装飾されている。</p>
<p>　枕元のスクリーンを触ると、静電気が発生して電気が消える。</p>
<p>　月が明るく、電気を消しても、お互いの顔がくっきり見えた。</p>
<p>　わたしたちは目を閉じて眠ろうと試みる。</p>
<p>　だれかひとりでも夜更かししてるとつい釣られて みんな夜更かししてしまうので、一緒に寝るときは、 物音を建てないようにする。</p>
<p>　しんと静まり返る。</p>
<p>　そろそろ15分くらい経ったかな。</p>
<p>　12時は過ぎたかも。</p>
<p>　でも、わたしはなんだか眠れなくて、目を開ける。</p>
<p>　わたしの目の前にソフィーヤの背中が現れる。</p>
<p>　ちょっと大きめのパジャマを着ているからか、 はだけて肩が見える。</p>
<p>　透き通った白い肌。</p>
<p>　暗い場所だと、その白さがさらに際立って、青白くも見えた。</p>
<p>　きれいな肌だ。</p>
<p>　わたしはちょっとどきりとしてしまう。</p>
<p>　それから、わたしはその肩がふるふると震えるように動いていることに 気づく。</p>
<p>　彼女の顔のあたりが、ぼんやりと明るい。</p>
<p>　どうやらディスプレイがついていて、彼女はなにか見ているみたいだ。</p>
<p>　起きてる。</p>
<p>　わたしは声をかける。</p>
<p>「ソフィーヤ、起きてるの……？」</p>
<p>　ソフィーヤは細い声で答える。</p>
<p>「うん……」</p>
<p>「なにしてるの？」</p>
<p>「ちょっと……論文を……書いてる……」</p>
<p>「論文？」</p>
<p>「うん……今度……投稿するんだけど……“あること”について……」</p>
<p>　わたしは興味を持ってたずねる。</p>
<p>　親友のことなら、なんだって知りたい。</p>
<p>「“あること”って？」</p>
<p>「それは……」ソフィーヤは身を翻し、くるりとこちらを向く。彼女は 真鳥をちょっと見てから言う。「うん……真鳥は寝てるみたいだし……アリスになら ……言ってもいいかも……」</p>
<p>「教えて。興味ある」</p>
<p>「GGH暗号——格子暗号のひとつ——について。GGH暗号というのは……噛み砕いて 説明すると……格子というのは、n個のm次元ベクトル——ただし、nはm以下——の整数結合の 集合のことで……nがじゅうぶんに大きいと……格子の最短ベクトル問題がNP困難に なることを根拠としている暗号で……」</p>
<p>「ちょっと待って」</p>
<p>「うん」</p>
<p>　わたしは一度深呼吸する。</p>
<p>「続けて」</p>
<p>「……まあ……つまり……その格子の最短ベクトル問題を量子コンピュータで解く アルゴリズムを、わたしは見つけたんだけど……」</p>
<p>「なるほど」</p>
<p>　わかってないけど。わたしは復唱して確認する。</p>
<p>「つまりその、ソフィーヤはGGH暗号を解読できちゃったわけね？」</p>
<p>　と、自分で言ってことの重大さを理解する。</p>
<p>　GGH暗号というのは、たしかFacebook Searchの暗号化にも使われていた 暗号だ。</p>
<p>　そして、今日の午後、そのFacebook Searchの暗号が解読されてページが 改竄された。</p>
<p>　このことから考えられるのって、つまり、ひょっとして……。</p>
<p>　わたしは考えたくないことを考えてしまって、頭をぶんぶん振って振り払う。</p>
<p>　忘れよう。</p>
<p>　たとえそうだったとしても、なにか理由があってのことだろう。</p>
<p>　それに、偶然かもしれない。</p>
<p>　それに、もしそうだとして、わたしが黙っていれば、問題は起こらないはず。</p>
<p>　そう、きっとそうだ。</p>
<p>　わたしはソフィーヤに言う。</p>
<p>「おやすみ、今日は寝るね」</p>
<p>　そう言って、わたしは彼女に背中を向ける。</p>
<p>　忘れよう。</p>
<p>　そう思って目をつむろうとしたとき、眼鏡にメールの着信が通知される。</p>
<p>　わたしはメールの差出人を見て、ぎょっとする。</p>
<p>　真鳥からだ。</p>
<p>　わたしは困惑する。わたしの目の前で寝ているはずの真鳥から、 どうしてメールが。</p>
<p>　そう思った直後、大量のメールが通知される。</p>
<p>　いろんな友達から同じタイトルのメールが何通も届く。</p>
<p>　2通や3通ではなく、2桁、そして3桁だ。</p>
<p>　明らかにただ事ではない。</p>
<p>　わたしは胸をどきどきさせながらメールを開く。</p>
<p>“わたしは格子の最短ベクトル問題を量子コンピュータで O(log n) で解くアルゴリズムを発明した. その証拠として, 2045年12月22日の昼, GGH暗号で暗号化された Facebook Search というウェブサイトのTCPパケットを改竄し, 2014年12月24日午前零時をもって, このメールを一斉送信するソフトウェアを, 同サイトから散布した. 図 1.1 は, 改竄された同サイトの スクリーンショットである. わたしの目的は, アルゴリズムの存在と, その危険性を世界に知らせることである. なお, アルゴリズムの詳細については, 現在まとめているところで, 匿名で, 近日公開予定である. 乞うご期待.”</p>
<h2>Latter</h2>
<p>　翌朝目覚めると、通知がたいへんなことになっていた。 たった1日で2500件のメールが届いたらしく、受信ボックスがそれで 埋まっていたのだ。</p>
<p>　真鳥も同じ状況になっているらしく、ベッドに横になったまま 律儀に1通ずつ既読としてマークしながら、彼女は狼狽した。</p>
<p>「2500件もスパムが送られてきてますよ……なにがあったんでしょう」</p>
<p>　わたしはベッドにぺたんと座って、毛布を着込むように肩にかけた まま、早朝の刺すような寒さで震えながら叫んだ。</p>
<p>「例の件に決まってるでしょ」</p>
<p>「例の件って？」</p>
<p>「マルウェアよ——Facebook Searchで配布されてたね！——そんなことも 想像つかないの？」</p>
<p>「でも、証拠がないですよ。ぜんぜんべつの件かも」</p>
<p>　ソフィーヤは、昨日夜遅くまで起きていたらしく、まだ可愛らしい寝息を立てて 眠っている。</p>
<p>　わたしは寒くてぶるぶる震えながら言う。</p>
<p>「考えてみれば、わたしたちは、マルウェアがいったいどんな プログラムなのか、ぜんぜん知らないのよ。犯人は、きっと、この マルウェアでなにか遠大な計画を実行しているのにちがいないわ」</p>
<p>　今日の午前零時、最初に送られてきたメールは、なにか 宣言のような内容だった。 GGH暗号を解読できるアルゴリズムを発明した から……とか。</p>
<p>　そのあと、メールは、わたしたちが眠っているあいだにも、 きっかり1時間おきに3桁通送られてきた。量は時間が経つごとに増え、 最初は100通ほどだったのが、現在では一度に500通ほど送られてくる。 現在、平均して1時間に300通ほど送られてきていることになり、 午前8時半現在、計2500件も溜まっていることになる。</p>
<p>　ところで、そのメールはすべて電話帳に登録していたはずの 知り合いのメールアドレスから送られてきている。 つまり、おそらくは、マルウェアに感染した 端末のアドレスを使い、その端末の電話帳を調べて、 送信してきているのだろうと思われる。</p>
<p>　知り合いのアドレスだから、アドレスでフィルタするわけにもいかない。</p>
<p>　タイトルなどの情報も重複がないようにハッシュ値のようなものになっている。</p>
<p>　テキストに至っては、なんと文字コードではなく画像データで エンコードされており、しかもメール1通1通でフォントが違ったり文字幅や 文字間隔が違ったり微妙に傾いていたりしている。</p>
<p>　どうにも機械的にスパムを判定するのは、なかなか難しそうだ。</p>
<p>　内容は午前1時以降はすべて同じで、次のようなものだ。</p>
<p>“これはスパムメールである. あなたは, おそらく, 何百何千と送られてくるこのスパムメールに, うんざりしているであろう. ところが, 幸運なことに, このスパムメールを受信しない方法がある. そうする方法は, 非常に簡単であり, 次のソフトウェアをインストールすれば よろしい. ただし, お使いのOSに注意してください. というのも, 間違ったバイナリをインストールしても, 効果はありません.”</p>
<p>　この文章のあとに、 Linux版、Windows版、Mac版、Android版、 iOS版、Firefox OS版、Windows Phone版、Chrome OS版など、さまざまな プラットフォーム用のバイナリへのリンク画像が列挙してある。</p>
<p>　いま8時半だから、また30分もすれば500件の通知が来るはずだ。</p>
<p>　メールのデスクトップ通知はオフにしてあるとはいえ、 これではメールのチェックがほぼできず、非常に迷惑だ。</p>
<p>　あとで、ソフィーヤが起きてきたら、問いただそうと思ってる。</p>
<p>　この事件の犯人は、たぶんソフィーヤだ。</p>
<p>　証拠はないとはいえ、彼女の発言と、犯人からのメールを比べれば、 じゅうぶん確信できる。</p>
<p>　彼女もGGH暗号を解読したと言っていたし、犯人もそう言ってる。</p>
<p>　おそらく同一人物であると考えるのは、自然なことだと思う。</p>
<p>　でも、ソフィーヤが犯人と考えるのは、状況証拠に過ぎない。</p>
<p>　ほとんど同時に世界の異なる場所で2人が同じような発見をすることは、 シンクロニシティといって、歴史的に見るとよくあることだ。</p>
<p>　もしかしたら、ソフィーヤの発見は、犯人とのシンクロニシティかもしれない。</p>
<p>　まだ、判断できない。</p>
<p>　犯人に繋がる手がかりをもっと集めることができれば、判断ができる かもしれない。</p>
<p>　ソフィーヤはとくに休日は、起きるのが遅い。</p>
<p>　一緒に暮らしてたから、わかる。</p>
<p>　すくなくとも、あと5時間くらいは起きないと思う。</p>
<p>　それまでに、わたしと真鳥だけでもできることはあるはずだ。</p>
<p>　わたしは言う。</p>
<p>「まずは、マルウェアの解析ね。あのマルウェアを仮想環境で走らせてみましょう」</p>
<p>　真鳥は答える。</p>
<p>「そうですね」</p>
<p>　わたしと真鳥は、ベッドから出て、サーバの方へ行く。</p>
<p>　サーバは180コアの256ビットCPUで、 16TBのメモリもある。</p>
<p>　ちなみにサーバの値段は、わたしたちが 買ったわけじゃなくて学校の備品だけど、2年前の相場で言えば、 およそ30万円。今年の相場だとたぶん15万円くらい。</p>
<p>　現在の〈マシン〉の動作に必要な最低限のスペックは、オクタルコアの 128ビットCPU、64GBのメモリだというのが通説だ。</p>
<p>　オクタルコアは8コアのことだから、単純に計算すると、 このサーバのすべての資源を使えば、20つくらいの 仮想〈マシン〉を走らせることができる。</p>
<p>　残りの20コアは、OSやもろもろのプロセスを走らせるのに割り当てた ほうが、無難だろう。</p>
<p>　わたしと真鳥は、サーバに20つの仮想〈マシン〉を用意する。</p>
<p>　それぞれの仮想〈マシン〉にダミーの電話帳とメールアドレスを 登録する。</p>
<p>　マルウェアの解析は主に逆アセンブルなどの方法でソースコードを 検証する静的解析と、安全なサンドボックスの環境で マルウェアを実際に実行してみて動作を観察する動的解析に わかれる。</p>
<p>　わたしたちがいましようとしているのは、動的解析のほうだ。</p>
<p>　仮想〈マシン〉で動的解析ツールを起動する。</p>
<p>　ただマルウェアを実行しても、ディスプレイには表示されない 裏の挙動は見えない。たとえば、秘密裏にファイルをダウンロードしていたり、 サーバへデータを送信していたり、奇妙なAPIを叩いていたりだとかいった ことは、動的解析ツールを使って解析する。</p>
<p>　わたしたちは、まず、結果がどうなるか、仮説を立てる。</p>
<p>　この実験で、なにを明らかにしたいのか。</p>
<p>　わたしは真鳥に言う。</p>
<p>「まずは、本当にこのマルウェアをインストールすると メールを送るのか、確かめましょう。メールが大量に 送られてきたのは、ほんとうはぜんぜんべつの事件という可能性もあるわ」</p>
<p>「そうですね、それがいいと思います」</p>
<p>　わたしは続ける。</p>
<p>「わたしは、このマルウェアをインストールすると、本当に その〈マシン〉はメールを送るようになると思うわ。 つまり、わたしの仮説は“マルウェアをインストールした〈マシン〉は、電話帳を ヒントにして、メールを送る”ということよ。これが 確かめられたとき、大量のメールはこのマルウェアが原因だと 言えるでしょう」</p>
<p>　そこで、わたしたちは、</p>
<ol>
<li>マルウェアをインストールした仮想〈マシン〉を1つ用意し、</li>
<li>マルウェアをインストールしていない仮想〈マシン〉を1つ用意し、</li>
<li>マルウェアをインストールした仮想〈マシン〉の電話帳に マルウェアをインストールしていない仮想〈マシン〉の アドレスを登録して、</li>
</ol>
<p>30分待った。</p>
<p>　すると、9時ちょうど、思ったとおり、 マルウェアをインストールした仮想〈マシン〉から、 インストールしていない仮想〈マシン〉へ、 電話帳に登録したメールアドレスにメールが飛んでいた。</p>
<p>　わたしは嬉しくて叫ぶ。</p>
<p>「思ったとおりね！　やっぱり、この大量のメールはあのマルウェアが原因 なのよ」</p>
<p>「そうみたいですね！」</p>
<p>　やはり、思ったとおり、マルウェアをインストールした〈マシン〉が、 その〈マシン〉の電話帳をヒントに、メールを送るようだ。</p>
<p>　つまり、このマルウェアは、バックグラウンドに常駐して、 このメールを送り続けるマルウェアなのだ。</p>
<p>　メールの送信は、マルウェアをインストールしないと発生しない。 一方で、メールの受信は、マルウェアをインストールしていなくても、 メールアドレスがだれかの電話帳に登録されているだけで、 発生する。</p>
<p>　わたしのように、マルウェアをインストールしなくても、 知り合いから無期限にメールを受信し続けるわけだ。</p>
<p>「ところで」とわたしは批判的に真鳥を見つめる。「昨日、あなたからも スパムメール、飛んできたんだけど」</p>
<p>　真鳥はぎくりとする。</p>
<p>「あはは……じつは、電車でここに来るとき、間違って実行しちゃいまして…… なにも起こらなかったから……大丈夫かなって、思ってたんですけど……」</p>
<p>「このドアホ！　大丈夫なわけないでしょうに！　いますぐ〈マシン〉の /etc/inittab を調べて、再起動しなさい！」</p>
<p>「はい……」</p>
<p>　ところで、そのマルウェアの送ってくるメールはおかしなものだ。</p>
<p>　そのメールの受信を停止したいなら、リンク先のソフトウェアを インストールすればよいのだという。</p>
<p>　本当に停止するのだろうか。</p>
<p>　その前に、そのアドレスが手がかりになる可能性がある。</p>
<p>　試しに、仮想〈マシン〉で受信したメールに張られているリンクのアドレスを 調べてみる。</p>
<p>　でも、手がかりにはならなそうだった。</p>
<p>　というのも、このリンクは、ウェブページへの リンクではなく、Data URI Schemeというスキームであり、 URL自体にプログラムが埋め込まれているからだ。</p>
<p>　それも、メール1通1通ごとに微妙にプログラムが異なっている。 単純なコピーではなく、プログラム自体の意味は変えずに変更することで、 機械的なチェックを切り抜けるようになっている。</p>
<p>　わたしは次の問題を提起する。</p>
<p>「ところで、メールに張られているリンク先のプログラムも問題よね。 犯人はこれでいったいなにをしようとしているのか」</p>
<p>「まずは、実際の状況に近い仮想環境をつくって、 実行してみましょうよ」</p>
<p>　わたしたちは、このプログラムをインストールすることで、 本当にメールが止まるのか、実験することにした。</p>
<p>　真鳥が考えを述べる。</p>
<p>「それにしても、メールを送るマルウェアを配布して、そのメールで メールを止めるプログラムを配布するなんて、妙な人ですよね」</p>
<p>「たしかに、そうね」</p>
<p>「わたしは、メールを止めることができるというのは、 事実だとしても真の目的ではなく、なにか裏の目的のための カモフラージュだと思います」</p>
<p>「わたしも、そう考えていたところよ。 メールを止めることのできるプログラムだというのは偽りよ。 これをインストールしても、きっと、メールは止まらないわ。 このメールは、たぶん、マルウェアのさらなる拡散を目的にしているのよ」</p>
<p>　マルウェアに感染した〈マシン〉は、メールをたくさん 送る。マルウェアに感染していなくても、メールを受信してしまう。 もし、メールを止めるプログラムだというのが偽りで、 そのメールからリンクされたプログラムは、実際には マルウェアを拡散するものだったら、 どうなるだろう。</p>
<p>　世の中の大半は、リテラシーが低い人たちだ。 わたしの感覚では、こんなメールが送られてきても、 インストールはしない。一目見て危険だと判断し、無視する。</p>
<p>　でも、世間の大半の人は、そういう思考をしない。 文言をすっかり信用して、メールを止めるために インストールしてしまう。</p>
<p>　そういうリテラシーの低い層を狙って、大量のメールを 人海戦術的にばらまけば、ほとんどは失敗するにしろ、かなりの 量の人が釣れる。</p>
<p>　スパムメールは、そういう原理になっている。</p>
<p>　したがって、もし、メールを止めるプログラムが、 実際にはマルウェアの拡散を狙っているのだとすれば、 時間を追うごとに、徐々に世界中に広まることになる。</p>
<p>　6次の隔たり。知り合いを6回たどれば世界中のどんな 人にも辿り着く。</p>
<p>　この仮説を支持するなら、6時間もすれば、メールは 世界中に広まっている。</p>
<p>　日本語では拡散力に限界がありそうだけど、言語設定を 調べて英文メールを送るようなことは、できるはず。</p>
<p>　午前1時からすでに6時間以上経っている。</p>
<p>　たぶん、問題は、すでに京都λ抽象学院や、 京都だけでは済まない。</p>
<p>　近畿全体か、あるいは本州、ひょっとすると、日本全体に 波及している可能性がある。</p>
<p>　わたしは冷や汗をかいてつぶやく。</p>
<p>「……なんか、すっごくやばい気がしてきた」</p>
<p>　真鳥が仮説を立てる。</p>
<p>「きっと、このメールに書かれたプログラムをインストールしても、 メールは止まりませんよ。むしろ、インストールすることで、 メールを送るようになってしまうはずです」</p>
<p>「わたしも同意見」</p>
<p>　そこで、わたしたちは、まず、さっきと違う環境を用意した。 さっきの実験が、今回の実験に影響してしまっては、まずいからだ。 わたしたちは、</p>
<ol>
<li>マルウェアをインストールした仮想〈マシン〉を1つ用意し、</li>
<li>マルウェアをインストールしていない仮想〈マシン〉を2つ用意し、</li>
<li>それぞれを電話帳に登録し合って、</li>
</ol>
<p>まず、1時間待った。</p>
<p>　マルウェアをインストールした仮想〈マシン〉から、 2つのマルウェアをインストールしていない仮想〈マシン〉へ、 メールが送られた。</p>
<p>　わたしたちは、2つのうち、一方の マルウェアをインストールしていない仮想〈マシン〉で、 そのリンクからメールを止めると銘打ったプログラムをダウンロードし、 それをインストールした。</p>
<p>　他方のマルウェアをインストールしていない仮想〈マシン〉では、 プログラムをインストール <strong>しなかった</strong> 。</p>
<p>　そして、待つ。</p>
<p>　日がのぼってきて、部屋がぽかぽかと暖かくなってくる。</p>
<p>　真鳥がうなだれて言う。</p>
<p>「わたし、このメールが短い間隔で何度も送られるのではなくて、 1時間おきに送信されるのがなぜなのか考えていたんですけど、 その理由がわかりました……調査する人を、こうして待たせるためです」</p>
<p>「なるほど……」</p>
<p>　1時間経った。</p>
<p>　午前11時だ。</p>
<p>　確認してみると、 マルウェアをインストールした仮想〈マシン〉から、 マルウェアをインストールしていないけど、メールを止めてくれるらしい プログラムはインストールした仮想〈マシン〉へ、 メールは <strong>送られていなかった</strong> 。</p>
<p>　マルウェアをインストールした仮想〈マシン〉から、 マルウェアをインストールしていないし、メールを止めてくれるらしい プログラムもインストールしていない仮想〈マシン〉へ、 メールは <strong>送られていた</strong> 。</p>
<p>　マルウェアをインストールしていないけど、メールを止めてくれるらしい プログラムはインストールした仮想〈マシン〉から、 ほかの2台へは、メールが <strong>送られていた</strong> 。</p>
<p>　マルウェアをインストールしていないし、メールを止めてくれるらしい プログラムもインストールしていない仮想〈マシン〉から、 ほかの2台へは、メールは <strong>送られていなかった</strong> 。</p>
<p>　真鳥が悔しそうに言う。</p>
<p>「どうやら、メールを止めてくれるらしいというのは、本当みたいですね」</p>
<p>　わたしは指摘する。</p>
<p>「でも、メールは止まる代わりに、やはり電話帳に登録されているアドレスへ メールを送信するようになってしまうようよ」</p>
<p>　これで、メールで送信されてくるプログラムがなにをするのかがわかった。</p>
<p>　どうやらメールに張られたリンクのプログラムを実行すると、 メールの宛先の対象から外してくれるらしい。実行すれば、ひとまず メールは受信しないようになるのだ。ところが、同時に、バックグラウンドで メールを送信するプログラムも動作するようになる。</p>
<p>　これでは、非専門家には、実際にスパムをブロックしてくれる 良質なプログラムかのように見えてしまう。</p>
<p>　スパムが送られてこなくなったという事実だけを見れば、実際に ブロックしてくれているのだから、取り急ぎ問題を解決するために、 ついついインストールしてみたくなる。</p>
<p>　現状、1時間おきに500通ものメールが送られてくる。毎回毎回通知が来ると うっとうしいので、通知をオフにせざるを得ない。その結果として、 現在メールがほぼ使えない。</p>
<p>　メールが使えないと困るので、わたしも、なんだか、とりあえず、 いまだけでも停止プログラムをインストールしてしのぎたくなる。 わたしからもスパムは送信されるけど、500通のうちの1通だ、 そんなに気にする人はいないだろう。</p>
<p>　ところで、500通ものメールの通知が来るのがうっとうしいので、 通知をオフにしていたから気づかなかったけど、どうやら この異常時に反応してメールを送ってきている友人もけっこういるらしい。 受信ボックスを開けてみると、スパムメールの上に何十通か未読 メールがたまっている。</p>
<p>　京都に住んでいる友人や、東京に住んでいる友人、それに、 ドイツに住んでいる友人からも異常事態を報告するメールが届いている。</p>
<p>　この事件は、すでにドイツまで波及しているらしい。</p>
<p>　というか、ドイツはUTC+2だから、現在は3時か4時くらいのはずだ。</p>
<p>　まあ、長期休暇に夜更かししてしまう気持ちはわかる。</p>
<p>　わたしはドイツにいる友人にメールでたずねる。</p>
<p>“メールは日本語で書かれてた？　それとも英語？　 ひょっとしてドイツ語で書かれてた？”</p>
<p>　彼女は答える。</p>
<p>“普通に英語だったと思うけど……”</p>
<p>　なるほど。どうやら日本語圏以外には英語で送信するようになっているらしい。</p>
<p>“1時間につき何通くらい来た？”</p>
<p>“んー……10件くらいかな……”</p>
<p>　日本よりは格段に少ない。とはいえ、事件発生から10時間足らずで すでに海外まで波及しているのだから、問題はどんどん大きくなるだろう。</p>
<p>“ありがと。あと、夜更かししないで早く寝なさい”</p>
<p>“こんなに面白い事件がリアルタイムで起きているのに寝るなんてもったいないよ”</p>
<p>　どうやら、彼女は事件というよりはショーのように考えているようだ。</p>
<p>　いくつかのブログサイトがこの事件をニュースにしていた。 ブログサイトは、どうやら事件を契機に現在のメールシステムや 〈マシン〉を批判しているようだ。いまどきブログサイトを見るなんて 老人くらいだろし、たぶん、現代のシステムを受けいれられない 層には受けのいい内容だろうと思った。</p>
<p>　犯人の目的は、まだ別にありそうだ。現在、大量の〈マシン〉に マルウェアがインストールされた状態にあるのは、まちがいない。 つまり、世界中の〈マシン〉が、現在犯人の手中にあるわけだ。 犯人はこのマルウェアを操作することで、なにか巨大な計画を 実行しようとしているにちがいない。</p>
<p>　身体中がぞわぞわ震え上がって、頭がくらくらしてくる。 問題がどんどん大きくなる。最初はちょっとしたことだったのに。</p>
<p>　でも、問題はわたしたちの構築したサーバから始まった。 ここで投げ出すわけにはいかない。</p>
<p>　わたしは心を持ち直して、この事件を必ず解決してやるぞと誓う。</p>
<p>　わたしは震える唇を噛みながら、冷静に真鳥に言う。</p>
<p>「ところで、停止プログラムをインストールすれば たしかにメールは停止するけど、技術的には、なにかのシステムがこれを 管理しているはずよ。気になるのは、そのシステムがなんなのか ということ」</p>
<p>　真鳥は閃いたように答える。</p>
<p>「そっか！　たしかに、特定の宛先に送らないようにするには、 宛先を管理するサーバが必要ですね」</p>
<p>「そう。つまり、マルウェアはそのサーバと通信しているはずなのよ」</p>
<p>「それを解析すれば……犯人に繋がるかもしれませんね」</p>
<p>　わたしたちは、動的解析ツールを使って、パケットを監視する。</p>
<p>　そして、監視しながら、仮想〈マシン〉に停止プログラムをインストールする。</p>
<p>　インストールした瞬間、 あるIPアドレスへ向けて停止プログラムが送信する暗号化パケットを、 ツールは捉えた。</p>
<p>　わたしは叫ぶ。</p>
<p>「それよ！　そのIPアドレスが停止済みアドレスを管理しているサーバだわ！」</p>
<p>　真鳥が興奮しながら言う。</p>
<p>「パケットは暗号化されているみたいです。解読してみないと、 確実なことは……暗号方式はなんでしょう？」</p>
<p>「さあ……ただ、暗号化するためには鍵が必要よ。鍵が見つかれば、 暗号方式もわかるし、ひょっとすれば、復号できるかもしれないわ」</p>
<p>「まずは、プログラムを静的解析しましょう。あるいは、 プログラムに鍵が埋め込まれてるかもしれません」</p>
<p>「いえ、そうじゃなくて、まずは strings コマンドで文字列が埋め込まれていないか確かめましょう」</p>
<p>　真鳥が strings コマンドでバイナリに埋め込まれた文字列を探す。</p>
<p>　すると、バイナリに鍵らしい文字列が埋め込まれていた。</p>
<p>　これは、明らかにRSA暗号の公開鍵だ。</p>
<p>　真鳥が嬉しそうに言う。</p>
<p>「これ、たぶんサーバの公開鍵ですよ！　これがあれば、 サーバの秘密鍵も復元できますね」</p>
<p>「でも、それには量子コンピュータが必要だわ」</p>
<p>「でも、このサーバの量子プロセッサでもできるかもしれませんよ」</p>
<p>「それは、できないってソフィーヤが……」</p>
<p>　そこまで言って、もしかしたら、あの発言は嘘だったかもしれないと 考える。</p>
<p>　このサーバの量子プロセッサでは並列素因数分解はできない。 それは、あるいは調査を阻止するための方便かも。</p>
<p>　嘘だとすれば、できるかもしれないということだ。</p>
<p>　わたしは力強く言う。</p>
<p>「できるかできないか、やってみましょう」</p>
<p>　公開鍵から秘密鍵を求める式は、数学的には、単純だ。</p>
<p>　素因数分解。</p>
<p>　数学の苦手なわたしたちでもわかる。</p>
<p>　素因数分解をどう解くかというアルゴリズムはちょっと複雑になる。</p>
<p>　ショアのアルゴリズムを実装すればいいのだけど、 論文のアルゴリズムを自分で実装に落とし込むのは、ちょっと手間がかかる。</p>
<p>　 ショアのアルゴリズムを、粛々と QCL という量子コンピューティング言語に 落とし込む。</p>
<p>　わたしや真鳥の得意とする言語は、 Standard ML なんだけど、 これは古典コンピュータの言語だ。</p>
<p>　聞くところによると、C言語の処理系のひとつである Clang は、 量子コンピューティングができるプラグマを提供しているらしいし、 C++の最新の規格である C++45 は、量子コンピューティングを サポートしているらしいのだけど……残念ながら、わたしたちには使えない。</p>
<p>　QCL は昔からある量子コンピューティング言語のひとつであり、 古典プログラミングと量子コンピューティングの両方を サポートしている。 QCL は量子コンピューティング言語として設計されたので、 無理に量子コンピューティングもできるように拡張された古典プログラミング言語で あるC言語やC++よりもシンプルな記法でプログラムを書ける。</p>
<p>　正直なところ、わたしも真鳥も、QCLでhello worldすら したことがないので、まずはドキュメントを読んで、 言語を理解することに時間をかける。</p>
<p>　でも、わたしも、たぶん真鳥も、1時間もドキュメントを読めば、 ひとまずプログラムを書けるようになるはず。</p>
<p>　それから午後。12時過ぎ。</p>
<p>　日が傾き始めて、肌寒くなってくる。</p>
<p>　ベッドでソフィーヤがうめいたかと思うと、 大きなあくびをかいて、のそのそと起きてくる。</p>
<p>　ソフィーヤが目をこすりながら言う。</p>
<p>「おはよう」</p>
<p>　真鳥が元気よく挨拶する。</p>
<p>「おはようございます！」</p>
<p>　わたしは皮肉っぽく言ってやる。</p>
<p>「ソフィーヤ、ずいぶんとたっぷり眠ったわね、12時間くらい？　 ひょっとして13時間かしら」</p>
<p>　ソフィーヤはわたしの嫌味にも眉ひとつ動かさず答える。 彼女は感情の表現がへたなのだ。</p>
<p>「わたしは今日……健康的な睡眠時間をとったと思う……つまり……9時間くらい」</p>
<p>　真鳥は呆れたようすで言う。</p>
<p>「夜更かししてたんですか？　気持ちはわかりますけど……」</p>
<p>「そうでもない……というのも……いつもと同じ」</p>
<p>　それより、わたしはソフィーヤに聞きたいことがある。</p>
<p>　こんな事件を起こした、張本人なのかどうか。</p>
<p>　昨日の夜、彼女が言っていたこと。</p>
<p>　それと、昨日の夜、最初に送られてきたメールの文言は一致している。</p>
<p>　偶然とは思えない。</p>
<p>　もちろん、わたしは彼女を責めたいのではない。</p>
<p>　彼女のことだから、なにか理由があってのことだと思う。</p>
<p>　考えてのうえの選択なら、わたしは彼女がどんな道を選んだのだとしても、 その選択を尊重してあげたいと思う。</p>
<p>　親友だから。</p>
<p>　ただ、理由が知りたい。</p>
<p>　秘密にされているのが気に食わないのかもしれない。</p>
<p>　わたしは、彼女とのあいだに壁なんてものはないと、勝手に思ってる。</p>
<p>　だからこそ、わたしたちのあいだに秘密がつくられていたことが、 気に食わない。</p>
<p>　だから、その理由を話してほしい。</p>
<p>　なにを考えて、どういう目的をもってこういうことをしたのかを、 打ち明けてほしい。</p>
<p>　わたしはちょっと声のトーンを落とすようにして、真鳥に言う。</p>
<p>「真鳥、ちょっと、ソフィーヤと2人で話がしたいの」</p>
<p>　真鳥はきょとんとする。</p>
<p>「えっ？　い、いいですけど……」</p>
<p>　ソフィーヤは小さな声でたずねてくる。</p>
<p>「どうしたの……？」</p>
<p>「聞きたいことがあって」</p>
<p>　真鳥は元気よく言う。</p>
<p>「あっ、公開鍵から秘密鍵を計算するプログラムは、 わたしが実装しておきますね。おふたりは、必要なだけ話してきてください！」</p>
<h1>Results</h1>
<p>　わたしはソフィーヤと一緒に部屋からでる。</p>
<p>　部屋の外の廊下は冷えきっており、まるで冷凍庫だ。 なるほど、ロシアより寒いというのもわかる。</p>
<p>　わたしは両手を合わせてこすりながら言う。</p>
<p>「まず、昨日のことから確認しましょう。一昨日、つまり 22日、わたしたちのサーバに何者かが侵入して、Facebook Searchの TCPパケットを改竄して、マルウェアをばらまいたわ」</p>
<p>「うん」</p>
<p>「わたしたちは、その事実を調査した。結論はこう。</p>
<ol>
<li>まず、ソフィーヤの TCPセッションを奪い、何者かはわたしたちのサーバに侵入した。証拠は、 TCPパケットのログ。ここで、ルートは奪えなかったらしいことに注意。</li>
<li>サーバからauthorized_keys、つまり公開鍵を盗んだ犯人は、 その公開鍵からソフィーヤの秘密鍵を計算した。 秘密鍵があれば、サーバにリモート・ログインできるようになる。 そして、犯人はその秘密鍵でサーバにログインした。 証拠はSSHサーバのログ。</li>
<li><p>そして、犯人は、サーバであるシェルスクリプトを走らせた。 そのシェルスクリプトが、マルウェアをサーバにホスティングさせ、 ルータからTCPパケットの改竄をしていた。 証拠は復元したシェルスクリプトのソースコード。</p></li>
<li><p>そして、そのシェルスクリプトから、わたしたちはマルウェアが ホスティングされているIPアドレスを入手し、マルウェアを入手した」</p></li>
</ol>
<p>「うん。それはわかってる」</p>
<p>「そして、今日の午前1時から、大量のスパムメールが届いているわ」</p>
<p>　ソフィーヤは目を逸らしながら答える。後ろめたい気持ちがあるからそういう 仕草をしたのではないだろう、彼女は目を合わせて話すのがもともと苦手なのだ。</p>
<p>「そう……それで？」</p>
<p>「このメールは、例のマルウェアが原因よ」</p>
<p>「本当に……？　証拠は？　偶然時期が重なった可能性もある」</p>
<p>「いいえ。午前中、わたしと真鳥で、昨日入手したマルウェアを調べたの。 その結果、マルウェアをインストールした〈マシン〉は、 1時間おきにメールを送信するということがわかったわ。 また、そのメールに書かれたリンクからダウンロードしたプログラムも、 同様に1時間おきにメールを送信するようになる」</p>
<p>「なるほど……」</p>
<p>「何度やっても再現できると思うわ。なんなら、ソフィーヤもやってみる？」</p>
<p>「いや……いい……アリスを……信用する……」</p>
<p>「よろしい。つまり、この大量のスパムメール事件の犯人と、Facebook Searchを改竄した犯人は同一人物よ」</p>
<p>「なるほど……わかりやすい」</p>
<p>「ところで、スパムメールのうち、面白いメールもあるわ。 今日の午前零時のメール。 GGH暗号がなんとか……これって、昨日、 寝る前にあなたがわたしに話してくれた内容とそっくり一致するわよね、 ソフィーヤ」</p>
<p>　ソフィーヤは即答する。</p>
<p>「うん」</p>
<p>「そんなことってあり得る？　偶然の一致の可能性もあるけど、 わたしは、そんなことはないと思う。犯人はあなたなのでしょう、ソフィーヤ？」</p>
<p>　ソフィーヤはちょっとの間黙って、答えを探すように考えてから、 答える。</p>
<p>「証拠は……ないでしょう？」</p>
<p>「う」</p>
<p>　そう。現在、犯人とソフィーヤを結びつけるものは、午前零時のメールだけ だ。いま、わたしたちのサーバをクラックした犯人＝Facebook Search改竄事件の犯人＝大量のスパムメール事件の犯人、ここまでは確かな 証拠を見つけている。でも、それとソフィーヤを結びつける証拠は、なにもない。</p>
<p>　ソフィーヤはニヤッと似合わない笑みを浮かべて言う。</p>
<p>「そうなるように……やったから」</p>
<p>　そうなるようにやった。なにを？　 証拠が見つからないようにやったということ？　それってつまり。</p>
<p>　わたしは確認する。</p>
<p>「あなたがやったってこと？」</p>
<p>　ソフィーヤは黙っている。</p>
<p>　ソフィーヤからしたら、ここでなにか言ったら、それが証拠として 採用される可能性もある。</p>
<p>　うかつなことは言えないのだろう。</p>
<p>　わたしは訴えるように言う。</p>
<p>「ソフィーヤ、わたしはあなたの味方よ。 わたしはあなたを捕まえたいと考えているわけではないのよ。 もちろん、スパムメールは迷惑だから、停止してほしいとは 思ってる。でもあなたの計画を邪魔したいわけではないの。 ただ知りたいのよ、なにを考えて、こんなことをしてるのか……」</p>
<p>「わたしも……アリスのことは……信用してる」</p>
<p>「じゃあ……」</p>
<p>　ソフィーヤは胸のあたりに手をあてて言う。</p>
<p>「アリスにだから言うけど……わたしがやった。 わたしは……“ある問題”を……匿名で提起する必要がある。 “ある問題”は、この社会にとって不都合な事実……わたしの身の安全が 保証されるとは限らない。だから、いままでだれにも言ってなかったけど…… ひとりだけの秘密にして計画を遂行するのは、思ったより つらかった……心が……胸の、内側が……ふたりだけの秘密を、共有できる 友達が欲しかった」</p>
<p>　ソフィーヤは、“ある問題”を提起するために、 こんなことをしているらしい。</p>
<p>　ソフィーヤは続ける。</p>
<p>「わたしは、“ある問題”を提起する必要があるのだけど、 その問題を提起するためには、トラフィックが必要…… というのも…… だれの目にも留まらない場所で提起しても、意味がないから……でも…… 普通にインターネットの文書として公開しても、トラフィックは、 思ったよりぜんぜん伸びないから…… いま……わたしは、世界中の〈マシン〉を汚染し、自由に あらゆる端末からメールを送ることのできる状態にある……つまり…… 世界中の〈マシン〉を使って、わたしは問題を提起する。 トラフィックは申し分がない……新聞や……いろんなサイトにも 掲載されるはず。通るかどうかわからない投稿論文よりも…… 確実……」</p>
<p>　ソフィーヤは、“ある問題”を提起するために、ここまで手の込んだことを しているらしい。</p>
<p>　そもそもの問題は、 ソフィーヤが、TCPセッション・ハイジャックでSSHコネクションを 奪われたことから始まっているけど、たぶん、その 奪った犯人はソフィーヤだ。ソフィーヤはたぶん、 偽装のために、自分自身をハイジャックしたのだ。 マルウェアをばらまいた問題が明るみになれば警察沙汰だけど、 SSHサーバを立てたくらいなら停学か、悪くても退学で済む。 退学と警察沙汰のどっちが悪いかは、まあ人にもよるだろうけど…… 退学のほうが死ぬより悪いと言いそうな友人には心当たりがある。</p>
<p>　それにしても、ソフィーヤがそこまでかけて問題にしている “ある問題”って？</p>
<p>　わたしは緊張してソフィーヤにたずねる。</p>
<p>「ソフィーヤは、なにをそんなに問題としているの？」</p>
<p>　ソフィーヤはつま先で円を描くように床をこする。</p>
<p>「その……それをアリスに話すのは、恥ずかしいというか……」</p>
<p>　ソフィーヤはそっぽを向いて、心なしか顔を赤らめている。</p>
<p>　わたしはちょっとおかしくなって、 なんだかほっとして言う。</p>
<p>「言っちゃいなさいよ」</p>
<p>「でも、寮の、廊下でというのは……寒いし……暗いし…… 汚いし……ちょっと場所を変えたい……かも……」</p>
<p>「じゃあ、どこがいい？」</p>
<p>「うーん……温かい場所……サーバルームとか」</p>
<p>　わたしは思わずくすくす笑う。</p>
<p>「サーバルームは寒いわ。温かかったら熱暴走しちゃうでしょ？」</p>
<p>「あっ、そっか……」</p>
<p>「学校の庭園に行きましょう。あそこは年中同じように草木を咲かせるために、 温度が管理されているわ」</p>
<h1>Discussion</h1>
<p>　わたしとソフィーヤはふたりで学院の庭園へ。</p>
<p>　冬でも緑色の草木が咲き続けている庭園は、 学院を幻想的に見せる。</p>
<p>　庭園はほとんど、というよりまったく見えないほど 透明なドーム状の壁で囲まれていて、 室内からでも青空が見え、日光が注ぎ込み、 室内は年中暖かく保たれている。</p>
<p>　壁はアーチ状の柱で支えられている。柱は不透明な グレーで、目に見える素材。これも透明にした方がいいんじゃないかな、 とも思うけど、この柱のおかげで壁の位置がわかるし、この柱自体も アーチ状なのでなかなかおしゃれ。</p>
<p>　専門ではないので詳しくは知らないけど、壁のなかに 真空な場所をつくることで、断熱し、外と中との温度差でも 結露が起こらないようになってる。</p>
<p>　扉も透明なので見えないんだけど、扉を縁取るようにして ガーデンアーチがある。透明な扉を開き、わたしたちは庭園に入る。</p>
<p>　そんな庭園の中央にある小さな屋根付きのパティオに、 わたしとソフィーヤは向かい合って座る。</p>
<p>　わたしは話の続きを求める。</p>
<p>「“ある問題”とは」</p>
<p>　ソフィーヤは指をいじりながら語りだす。</p>
<p>「将来の暗号方式の問題……」</p>
<p>「ふむ」</p>
<p>「量子コンピュータが一般的になったのは……格子暗号が実用化されるよりも ずいぶん前のこと。量子コンピュータの量産が始まると…… RSA暗号は簡単に解読できるようになった。もちろんそれ以前にもRSA暗号の 脆弱性はたびたび発見されてて——たとえば、公開鍵のグレブナー基底計算法 とか——それからしばらくして……格子暗号のひとつ…… GGH暗号が実用に堪え得る精度で復号できるようになった。 GGH暗号はむかしからある暗号だけど……ずいぶん前からその問題として 復号の精度が指摘されていて……それが実用的になったのがつい最近。 量子コンピュータはたくさんの計算を高速に処理できたけど…… それは暗号の解読も速くなるということで…… 副作用として……RSA暗号を含め、多くの暗号方式を安全ではなくした。 そんななかで……量子コンピュータにも耐えられる耐量子計算機暗号である GGH暗号は……次世代の暗号方式として期待されていた。 いや……むしろ……わたしに言わせれば、まだ現実に使える 暗号方式が残っているという安心感が」</p>
<p>「ちょっ、ちょっ、ちょっと待って」</p>
<p>「はい」</p>
<p>　わたしは暗号論は専門ではない。というか、わたしは得意なこと なにもないんだけど……。暗号論の言葉が怒濤に並び立てられてちょっと びっくりしてしまった。わたしは眼鏡を持ち上げて目の付け根をしばらく 押さえてから離し、言う。</p>
<p>「続けて」</p>
<p>「うん……ともかく……量子コンピュータの時代にも……まだ実用的な暗号方式は 残っていたの。GGH暗号は……Facebook Searchなど著名なサイトが導入している 方式で……いまいちばん期待されている方式」</p>
<p>「なるほど。それはまあ、知ってるわ、わたしでも……」</p>
<p>「でも……わたしは……GGH暗号をO(log n)で解読できるアルゴリズムを発見した」</p>
<p>　それはすごい。それだけで論文になると思う。 その事実だけ切り取ってほめてあげたい。</p>
<p>　ソフィーヤは続ける。</p>
<p>「ただ……それは主張じゃなくて……事実。 わたしの主張は……ほかに2つある」</p>
<p>「というと」</p>
<p>「ひとつ。わたしは……あらゆる暗号方式には……それを多項式時間で 解読できるアルゴリズムが存在すると思っている。つまり……その…… 近い将来……どんな暗号も解読可能になるだろう……ということ」</p>
<p>「暗号論そのものが崩壊すると言いたいわけ？」</p>
<p>　ソフィーヤはうなずく。</p>
<p>　わたしは呆れる。</p>
<p>「そんなことあり得ないと、わたしは思うわ。それで、ふたつめは？」</p>
<p>「わたしはインターネットの仕組みそのものを考え直す必要があると 思ってる——というのも、インターネットは暗号論がないと成り立たない——わたしは 暗号論を仮定しないインターネットを〈オープンネット〉と名付ける——それは、 すべてが自由でオープンなインターネット——〈オープンネット〉には…… HTTPの仕組みをそのまま使える。ただ……認証技術は使えない。それに…… 秘匿通信もできない。“使えない”とか……“できない”といったネガティヴな 言葉より……“使えないように修正されている”とか……“できないように改善されている”と いう……ポジティヴな言葉を使ったほうがいいかもしれない。 つまり……たとえばFacebook Searchだとか…… そういう認証技術が秘匿通信を前提としたウェブサイトを……滅ぼして…… 必要ではない技術でインターネットをつくりなおす」</p>
<p>　〈オープンネット〉？　彼女はいきなりなにを言い出すんだ。 たしかにGGH暗号を解読したのはすごいけど、それにしても、 いきなり突飛過ぎる。</p>
<p>　わたしは手をひらひらさせる。</p>
<p>「なるほど、そういう考え方もアリだと思うわ。 小数派だと思うけどね、わたしはあなたの考えが 間違いだとか誤っているだとか言うつもりはまったくもってないわ、 親友の考えは尊重したいもの。でも、そんな主張をして、どうするの？」</p>
<p>「わたしは、この主張をして、賛同者を集める。 〈オープンネット〉の実現は、ひとりではできない。 仲間が必要」</p>
<p>　彼女の言ってることは論理の飛躍だと思う。 たしかにGGH暗号を解読した事実は称えられるべきものだと思う。 でも、そこからこんな考えに発展するか。実現可能か？　インターネット をつくりなおすなんてことが。</p>
<p>「集まると思う？　匿名で公開するんでしょ？　それに、 もし名前を出すのだとしても、実績のない学生ひとりに、 賛同者が、本当に集まると？」</p>
<p>　ソフィーヤは力強く言う。</p>
<p>「そのために……まず、わたしは事実をつくる。つまり……現代の暗号化技術が…… ほんとうは安全ではなく…… まったく危険なのだということを……世に知らしめるの。 匿名のだれかが暗号を解読して……ページを改竄した事実を…… わたしは積み重ねる。そして……その事実を世界中に公開する。 そうすれば……きっと……自然と人々は気づくと思う。 安全な暗号なんてものは幻想なんてことに……。 そういう要請が市民から集まれば……自然と、社会は、暗号技術を 必要としないようにインターネットをつくりなおすように動くはず」</p>
<p>　わたしは気が遠くなる思いだった。 彼女は、このことを発端にして、社会の流れを変え、 インターネットを〈オープンネット〉なるものに変えようと 考えているのだ。</p>
<p>　インターネットはもはや社会の根幹とも呼べるインフラだ。 そのインターネットそのものをつくりなおすというのは、 もはや、社会そのものをつくりなおすとも言える。</p>
<p>　これはもはや技術の問題ではなく、社会の問題だ。</p>
<p>　彼女は自分の考えているように社会を変えようとしているのだ。</p>
<p>　ソフィーヤは言う。</p>
<p>「〈オープンネット〉では、情報は、すべて公開されていることを前提としている。 この世界に、秘匿通信なんてものはない」</p>
<p>　わたしはこみかみを抱えながらたずねる。</p>
<p>「それで、その主張をするために、マルウェアをばらまたいの？」</p>
<p>「そう」</p>
<p>　わたしは頭が痛くなってきた。</p>
<p>　もちろん、わたしはその考えを否定しようとまでは思わない。</p>
<p>　親友の考えていることだから、できるだけ尊重してあげたい。</p>
<p>　でも、非現実的というか、スケールが大き過ぎるというか、 わたしの手には負えない。</p>
<p>　それに、インターネットをつくりなおすって、いったいどれだけの 時間がかかるというんだ。</p>
<p>　数年、いやもっと、数十年、ひょっとしたら、数百年はかかるかも。</p>
<p>　そのあいだ、ずっとスパムメールが飛んでくるのは、正直なところ、 ごめんだ。</p>
<p>　迷惑過ぎる。</p>
<p>　わたしは、わたしの結論をくだす。</p>
<p>「ソフィーヤ、あなたの考えはわかったわ。 あなたは、あなたの考えで行動すればいいと思う。 でも、わたしは、わたしの考えで行動するわ。 わたしは、世界中の〈マシン〉で動いている マルウェアを停止して、この問題を解決してみせる。 どうやらあなたはそうとう強い思想に囚われているみたいだから、 わたしは、あなたに訴えるのではなく、技術的に、 この問題に対処してみせるわ」</p>
<p>　ソフィーヤがニヤッとして答える。</p>
<p>「……わたしが勝つか……アリスが勝つか……最後は単純な勝負……勝ったほうが…… 正しい……」</p>
<h1>Conclusion</h1>
<p>　わたしとソフィーヤは庭園から寮に戻る。</p>
<p>　真鳥が退屈そうに漫画を読んでいた。</p>
<p>　コミック百合姫で連載されている漫画の単行本だ。</p>
<p>　真鳥がわたしたちを見て、つまらなそうに言う。</p>
<p>「遅いですよ、ふたりとも」</p>
<p>　ソフィーヤが謝る。</p>
<p>「ごめん……つい……議論が白熱して」</p>
<p>　わたしが指摘する。</p>
<p>「白熱してたのは、あなただけじゃない」</p>
<p>「そう……かな……」</p>
<p>　真鳥が割り込む。</p>
<p>「そ、れ、よ、り、もっ。マルウェアに埋め込まれた公開鍵から、 秘密鍵、計算できましたよ！」</p>
<p>　ソフィーヤが怪訝な顔をする。</p>
<p>「本当？」</p>
<p>「はい！　ソフィーヤさんは寝てたから知らないでしょうけど、 わたしたち、午前中にマルウェアに公開鍵が埋め込まれていることを 突き止めて、QCLでショアのアルゴリズムを実装して 秘密鍵を求めようとしていたんですよ」</p>
<p>「なるほど……」</p>
<p>「それから、暗号化パケットを解読することができました。 パケットはSSHと同じ手順で、共通鍵のようなものを送っていました。 その共通鍵は単純なAESの鍵で、通信をすべて復号できました」</p>
<p>　わたしはわくわくしてたずねる。</p>
<p>「で、どうだった？　もしかして、TCPセッション・ハイジャックできたり しない？」</p>
<p>「いいえ……TCPセッション・ハイジャックをするプログラムは、 わたしには書けません」真鳥は屈託のない笑顔で言う。「諦めました！」</p>
<p>　わたしは思わず笑ってしまう。</p>
<p>「でも、だれかが書けばできるかもしれないわ」</p>
<p>　真鳥がソフィーヤを見て言う。</p>
<p>「それなら、ソフィーヤさんが適任でしょう」</p>
<p>　ソフィーヤは黙ったままなにも言わない。</p>
<p>　わたしが代わりに答える。</p>
<p>「いいえ、彼女はやらないわ」</p>
<p>　真鳥がきょとんとする。</p>
<p>「やらない？」</p>
<p>「理由があるのよ。わたしがやるわ」</p>
<p>　と言っても、わたしにも自信があるわけではない。</p>
<p>　できるかできないかは、わからない。</p>
<p>　でも、するしかない。</p>
<p>　これは、わたしとソフィーヤの勝負なんだ。</p>
<p>　できないということは、このまま降参するということ。</p>
<p>　意地でも負けられない。</p>
<p>　わたしは付け加える。</p>
<p>「それと、真鳥、犯人探しは今日でおしまいよ」</p>
<p>　真鳥が驚く。</p>
<p>「犯人、わかったんですか！？」</p>
<p>「いいえ」わたしは言うべきか迷う。真鳥も友達のひとりだけど、 秘密を守ってくれるかどうかはわからない。わたしは嘘を吐く。 「諦めるのよ！　よく考えてみてよ。いまは、冬休みよ？　犯人のために、 わたしたちがこれ以上寮に泊まる必要があるかしら」</p>
<p>　真鳥はあごに指をあてて考え、答える。</p>
<p>「ないですね」</p>
<p>　ソフィーヤが付け加える。</p>
<p>「SSHサーバも止めたし……これ以上は……わたしたちの責任じゃない」</p>
<p>　わたしは指摘する。</p>
<p>「“わたしたち”？　複数形？　大きな主語ね、そこは“わたし”、単数 じゃないかしら、ソフィーヤ」</p>
<p>　ソフィーヤは思案する。</p>
<p>「たしかに……そうかも……」</p>
<p>　そこでわたしが言う。</p>
<p>「でも、犯人を突き止めるのは諦めるけど、マルウェアは止める 必要があるわ」</p>
<p>　真鳥が質問してくる。</p>
<p>「でも、どうやって？」</p>
<p>「考えてみて。メールを停止するプログラムは、あるサーバに 登録されたアドレスのリストで、停止済みかどうか管理しているのよ。 そして、停止したかどうかは、どうやら停止プログラムが起動されたとき、 メールアドレスをサーバに送ることで管理されているようだわ」</p>
<p>「なるほど……こちらから、偽のアドレスを送信するんですね！　その サーバに！」</p>
<p>「そう。うまく騙すことができれば、ひとまず、偽のアドレスを送ることで、 そのアドレスへの送信を停止するようにしむけられるはずよ」</p>
<p>　ソフィーヤが冷静に指摘してくる。</p>
<p>「それは……むだ……というのも……対策済み……だから」</p>
<p>　真鳥が疑問を浮かべる。</p>
<p>「“対策済みだから”？　どうしてそうわかるんですか？」</p>
<p>　ソフィーヤがぎくりとする。</p>
<p>「日本語をまちがえた……対策済み……“だろう”から」</p>
<p>　真鳥が納得する。</p>
<p>「たしかに、その可能性は高いですね」</p>
<p>　わたしはさり気なくたずねる。</p>
<p>「どうやって対策したのかしら」</p>
<p>　ソフィーヤは嘘を吐くのが苦手だ。</p>
<p>　一緒に暮らしていれば、自然とわかる。</p>
<p>　ソフィーヤは答える。</p>
<p>「秘密鍵で認証してる……つまり……秘密鍵ひとつにつき、 停止できるアドレスはひとつまで……だ ……と思うというか……わたしならそうする」</p>
<p>「なるほど、たしかにそれなら偽のアドレスを送るのは困難ね。 でも、そうなると、マルウェアはひとつひとつ異なる 秘密鍵を持っているということになるわね。 さらに、動的な公開鍵登録機構も必要なはず。 どうやってそれを実現しているのでしょう」</p>
<p>「すでに登録されている秘密鍵から……公開鍵を登録できるようにしてある ……んだと思う」</p>
<p>　真鳥が意見を述べる。</p>
<p>「すると、すでに登録されている秘密鍵からなら、 偽の公開鍵を送り込めることになりますね」</p>
<p>　ソフィーヤがぎくりとする。</p>
<p>「その可能性は……ある」</p>
<p>　わたしが決定する。</p>
<p>「その手で行きましょう。まずは、公開鍵を動的に登録する パケットを解析するのよ」</p>
<p>　真鳥が元気よく飛び上がる。</p>
<p>「了解！」</p>
<p>　マルウェアを仮想環境で走らせて、公開鍵を登録するパケットを 送信していないか、解析する。</p>
<p>　マルウェアがメールを送信すると同時に、 怪しいパケットがサーバに送られる。</p>
<p>　パケットを解読すると、明らかに公開鍵が。</p>
<p>　公開鍵の数は、メールの数とぴったり一致する。</p>
<p>　つまり、秘密鍵も、おそらくメールの数とぴったり 一致する数、新たに生成されているだろうということだ。</p>
<p>　秘密鍵は、たぶん、メールにリンクされた停止プログラムに 埋め込まれているのだろう。</p>
<p>　ということは、ひとつのアドレスへのメール配信を停止するには。 ひとつにつき、公開鍵と秘密鍵のペアを生成して、 このマルウェアの秘密鍵を使って署名し、サーバに送信すればいい。 そして、その秘密鍵を使ってアドレスを送信すれば、めでたく そのアドレスへのメール配信は止まる。</p>
<p>　わたしは言う。</p>
<p>「試しに、わたしのアドレスへのメール配信を停止してみるわ。 もう何時間も、何千通も、うっとうしくてしょうがないから」</p>
<p>　理屈に従えば、</p>
<ol>
<li>まず、マルウェアを仮想環境にインストールする。</li>
<li>公開鍵と秘密鍵のペアを生成して、 そのマルウェアの秘密鍵で公開鍵を署名して、 サーバに登録する。</li>
<li>新たに生成された秘密鍵で、わたしのアドレスを署名して、 サーバに登録する。</li>
</ol>
<p>という手順を踏めば、わたしへのメール配信はとりあえず止まり、 さらに、わたしの〈マシン〉は、マルウェアには感染しないはずだ。</p>
<p>　わたしはその手順で実際にやってみる。</p>
<p>　それから1時間が経つ。</p>
<p>　ソフィーヤはコンビニへ買い物へ行くと言って部屋から出て行ってしまった。 買い物にしては帰りがずいぶん遅い。 たぶん、買い物へ行ったのではなくて、本格的な設備のある場所へ行って、 わたしに対抗しようとしているのだ。</p>
<p>　通知が遅いなと思っていると、実際にメールの送信は止まっていた。</p>
<p>　わたしは嬉しくて思わず高い声をあげる。</p>
<p>「やった！　成功よ」</p>
<p>　これでメールは送られてこないはずだ。 わたしはるんるんとした気分でメールのデスクトップ通知をオンにする。 これでちゃんとメールのチェックができる。</p>
<p>　真鳥は受信したメールを律儀に1通ずつ確認して言う。</p>
<p>「アリスさんから、メールは来ていないみたいです」</p>
<p>「当然よ」</p>
<p>　あとは、この手順を、世界中の人に適用すればいい。</p>
<p>　ただ、問題は、世界中の人のメールアドレスを、どうやって 探し出すかということ。</p>
<p>　その方法が思い浮かばない。</p>
<p>　わたしが爪を噛みながら考えていると、動的解析をしている 真鳥が叫んだ。</p>
<p>「なんだか、マルウェアをインストールした仮想環境に妙なパケットが 流れてきてます」</p>
<p>　わたしはいらいらしながら答える。</p>
<p>「妙？　なにが妙なの？　それはわたしの思考を邪魔するに足る ものなの？」</p>
<p>「暗号化されていましたけど、復号してみると、 シェルスクリプトみたいです。どうやら、これは…… マルウェアがインストールされた〈マシン〉に、 命令を送っているようです」</p>
<p>「命令？　遠隔操作してるってこと？」</p>
<p>「そうです。あるIPアドレスへ向けて〈マシン〉にpingを打たせています。 どうやら、生きている〈マシン〉を特定しているみたい」</p>
<p>「つまり……どういうことよ」</p>
<p>「どうやら、マルウェアがインストールされた〈マシン〉は、 犯人によって一斉に操作できるようになってるみたいです」</p>
<p>「ふん。それがいったい……」と言ったところで、思いついた。 「逆に、それが利用できないかしら。こちらから偽の 命令を送ることができれば……」</p>
<p>　こちらかに偽の命令を送ることができれば。 任意の命令を送ることができるのだから、“マルウェアを消除せよ”という命令も 送れるはず。それができれば、一気に世界中からマルウェアを 消し去ることができる。</p>
<p>「それは、わたしも考えましたけど、どうやって送るんです？」</p>
<p>「犯人と同じやり方をとりましょう」</p>
<p>「というと？」</p>
<p>「インターネットはルーティングで成り立っているのよ。 京都の一定数の人の〈マシン〉からインターネットへの ルーティングは、この学院のルータを通すはず。 学院のルータから返信するパケットを改竄して、 マルウェアへの命令にしましょう。 そうすれば、京都のマルウェアを、このサーバから操ることができる」</p>
<p>「でも、それだと京都のマルウェアは操れますけど、 世界中のは、とても……」</p>
<p>「だから、犯人とまったく同じ手を使うのよ。 マルウェアへの命令は“京都λ抽象学院のサーバへアクセスするリンクを 掲載したメールを、電話帳に載った友人へ送ったあと、 マルウェア自体を消除する”よ」</p>
<p>「そっか……！　このサーバからは、常に命令を送信する パケットを送り続けるんですね」</p>
<p>「そう。そうすれば、メールを見た人をこのサーバへ 誘導して、このサーバから命令を送ることができる。 メールを見た人からその友人へリンクも送ることで、 最終的には、世界中の人をこのサーバへ誘導し、 マルウェアを消除できるはずよ」</p>
<p>　ただ、それをするプログラムを組むのは、たいへんそうだ。</p>
<p>　難しいプログラムではないと思う。ただ時間はかかりそう。</p>
<p>　気づくと、もう夕暮れが見えていた。</p>
<p>　空は暖色を帯びている。</p>
<p>　これからプログラムを書くとすると、とくに兵庫に住んでいる真鳥は、 今日、帰れるかどうか怪しい。</p>
<p>　わたしは確認する。</p>
<p>「いまからやると、今日は帰れないかもね」</p>
<p>「そうですね」</p>
<p>「やる？　それとも、明日にする？」</p>
<p>　真鳥は力強く宣言する。</p>
<p>「やりましょう！　マルウェアを、この世界から取り除くんです」</p>
<p>　頼もしい。</p>
<p>「よしきた。でもね、真鳥、キーボードはひとつだけなのよ。 わたしがやるから、真鳥は帰ってもいいわよ」</p>
<p>「いいえ、それでは、プログラムがちゃんと動くか心配です」</p>
<p>「それってどういう意味よ」</p>
<p>「わたしがレビューします」</p>
<p>「ふん。気に入らないけど。わかったわ」</p>
<p>　わたしはプログラムを書く。</p>
<p>　久しぶりの Standard ML。</p>
<p>　Socket モジュールは Standard ML の Basis Library のひとつ。 オプショナルだから、実装されていない可能性もある。</p>
<p>　Socket モジュールの関数を使ってコードを書く。</p>
<p>　そうしてコードを書くこと5時間ほど経過する。</p>
<p>　もう午後の9時だ。</p>
<p>　真鳥は眠くなってしまったのか、ベッドで横になっている。</p>
<p>　たまに話しかけると返事が返ってくるので、寝たわけではないみたいだけど、 ぐったりしていて、漫画を読む気力もないみたいだ。</p>
<p>　日もすっかり落ちた頃。</p>
<p>　やっとプログラムが完成した。</p>
<p>　わたしはキーボードから飛び退いて、ベッドに大の字で飛び込んで 真鳥に言う。</p>
<p>「できた。レビューして」</p>
<p>「はい……」</p>
<p>　わたしは、さすがに体力の限界だ。</p>
<p>　真鳥は真鳥で、疲れているようだ。なにもしなくても、 ここ2日、気を張りっぱなしだったからな。</p>
<p>　真鳥はレビューを終えて言う。</p>
<p>「ちゃんと動くと思います。仮想環境でテストしてみますか？」</p>
<p>「いいえ、いいわ。自信は……あるわけじゃないけど、もう、 疲れたから……もしバグってたら、もう1回やってみましょう」</p>
<p>「了解。あ、でも、ちょっとプログラム、変えますね」</p>
<p>　わたしはいらっとする。信用されてないってこと？　わたしは不機嫌になって 怒鳴る。</p>
<p>「どうしてよ」</p>
<p>「いいえ、ちょっとしたことです。どの程度の数マルウェアが 消除できたか、ログをとろうと思いまして」</p>
<p>「なるほど」 頭がうまくまわっていなかったので、わたしはあまり考えずに返答してしまう。 「それは良い案ね」</p>
<p>「マルウェアがうまく消除できたら、アリスさんのアドレスに メールを送るようにしました」</p>
<p>「良い仕事。……って、え？」</p>
<p>　つまり、わたしのアドレスに世界中からメールが送られてくるってこと？</p>
<p>「では起動しますね」</p>
<p>「……ちょ、ちょ、ちょっと待ったぁ！」</p>
<p>「えっ、もう起動しちゃいましたけど」</p>
<p>　すると、それから怒濤の勢いでわたしの眼鏡に通知が来る。 128通、256通、512通、1024通、2048通……どんどん増える。 通知が多過ぎて、〈指輪〉を動かしても反応がない。 フリーズした。もはやDoS攻撃だ。</p>
<p>　それでも止まることのない通知。通知の数は 京都の人口を軽々と越え、近畿の人口の数にまでのぼっている。</p>
<p>　〈マシン〉と〈眼鏡〉が熱くなってきた。なんかやばいにおいがする。 わたしは〈眼鏡〉をはずし、〈マシン〉をポケットからだして机の上に置く。 見てられない。</p>
<p>　わたしは真鳥を痛烈に批判する。</p>
<p>「そもそもログをとろうという考えがまちがいだったわ。 世界中の億レベルのトラフィックのログをとったら ディスクがたいへんなことになる」</p>
<p>　真鳥は申し訳なさそうに言う。</p>
<p>「すいません……」</p>
<p>「ま、プログラムが正常に動いているのがわかるから、 とりあえずよしとするわ」</p>
<p>　ちなみに億レベルのトラフィックでもわたしたちのサーバは 大丈夫だ……と、思う、たぶん。</p>
<p>　まだ帰ることのできる時間ではあった。でも、 今日はクリスマス・イヴだし、せっかくだから寮に泊まることにした。 もしかしたら、ソフィーヤが帰ってくるかもしれないし。</p>
<p>　それから数時間後、ソフィーヤが戻ってきた。 彼女はケーキを買って帰ってきた。</p>
<p>　真鳥が嬉しそうに目をきらきらさせる。</p>
<p>「ケーキ！　そういえば、今日ってクリスマス・イヴですね」</p>
<p>　ソフィーヤはつぶやく。</p>
<p>「ちゃんと……年の数……ろうそくも買ってきた」</p>
<p>　真鳥がたずねる。</p>
<p>「今日って、だれかの誕生日なんですか？」</p>
<p>　ソフィーヤがわたしを指差す。</p>
<p>　そういえば、昨日、12月23日はわたしの誕生日だ。</p>
<p>　ソフィーヤが言う。</p>
<p>「今日じゃないけど……ついでです」</p>
<p>　彼女はそれを机の上におくと、不機嫌そうにベッドに横になり、 ぶっきらぼうに言う。</p>
<p>「負けた」</p>
<p>　真鳥がきょとんとする。</p>
<p>「負けたって、なにがです？」</p>
<p>　どうでもいいけど、真鳥は、ここまできて気づかないのか。 鈍感にもほどがある。いや、わたしが知ってるから そう思うだけなのか。</p>
<p>　ソフィーヤがわたしに言う。</p>
<p>「24時間もすれば……マルウェアはみんな消えると思う……実際…… どんどん応答がなくなってる……」</p>
<p>　わたしは勝ち誇った笑みを彼女に向ける。</p>
<p>「わたしの勝ちね」</p>
<p>「うん。わたしの負け」</p>
<p>　真鳥がベッドから降りて、ケーキをキッチンへ運んで、 笑顔でみんなに言う。</p>
<p>「事件も解決したことですし、今日はみんなで ケーキを食べましょう！」</p>
<p>　真鳥が鼻歌を歌いながらケーキを切り始める。</p>
<p>「6等分でいいですよね」</p>
<p>　ともあれ、こうして、ソフィーヤの起こした事件は、無事解決した。</p>
<p>　わたしたちはその夜、急遽クリスマスの用意をすることになり、 午後10時でもまだ空いているお店を調べて、できるだけ豪華な 飾りを寮に施した。</p>
<p>　冬休みなので、学生寮に、わたしたちのほかに生徒はいない。</p>
<p>　正真正銘、3人きりのクリスマス・イヴだ。</p>
<p>　月はすこし欠けていて、やや雲がかかった夜だった。</p>
<p>　暖房はかけていなかったけど、みんなでいると、 心なしか寮は暖かかった気がした。</p>
<p>　わたしたちは、午前4時頃までばか騒ぎして事件の解決を祝った。</p>
<p>　わたしの〈マシン〉と〈眼鏡〉は、熱暴走でいかれてしまい、 起動しなくなったので、後日修理にだすことになった。 修理費はもちろん、真鳥とソフィーヤに負担させた。</p>
<p>　ところで、あとで真鳥から聞かされた話がひとつだけ。</p>
<p>　わたしたちがマルウェアを駆逐するプログラムを書いているあいだに、 じつは、マルウェアは面白いメールを1通だけ、世界中に送信していた。</p>
<p>　その内容が次の文章だ。</p>
<p>“わたしは格子の最短ベクトル問題を量子コンピュータで O(log n) で解くアルゴリズムを発明した. そして, それを匿名で公開する予定 であったが, 残念ながら, わたしに対抗するハッカーが 本プログラムを消除するプログラムを開発中である. そのため, 前言撤回 させて頂く. というのも, アルゴリズムの詳細は, まだ文章としては まとまっておらず, 対策される前に公開することは難しい. そのため, ここは, わたしは子の最短ベクトル問題を量子コンピュータで O(log n) で解く真に驚くべきアルゴリズムを見つけたが, この納期はそれを書くには短過ぎるという ことで, ひとつ手を打っていただきたい. では, これにてさらばである. 追伸: わたしの親愛なる友人へ. お誕生日おめでとう.”</p>
<p class="local-vars">
(* Local Variables: *)<br />
(* Continued-from: nil *)<br />
(* Continued-on: nil *)<br />
(* Revision: &quot;d8359797e8b7cc1ad8ad93bd70e8d90f9b4f32ea&quot; *)<br />
(* End: *)<br />
</p>
</body>
</html>
